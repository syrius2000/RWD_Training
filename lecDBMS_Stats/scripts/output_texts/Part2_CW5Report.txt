Part2 社内データベースの利用
Part2 社内データベースの利用
社内データベース CW5 内情報分析事例について
確率モデルを利用した各種発生傾向の把握
M. Yamaguchi
2016/10/11
November 30, 2016 1 / 84

Part2 社内データベースの利用
説明概略
Programing Database
計算機科学
↘ → 
Data Science
← ↙ 
科学的な安全対策
経験科学
→ → 
理論科学← ← 
↖ ← 
S.O.P Statistics
November 30, 2016 2 / 84

Part2 社内データベースの利用 CW5 内データ基礎統計値
集計対象
WT の初期取り決めにより，下記条件に適合する 28075 件，75 か月分をデータセットとして本検討
に用いた．
期間設定理由は，１）DB システム変遷や２）E2B/M2 の ICSR 項目が変わったことなどが発生し，
同じ条件でデータが保存されていないとの事だっ．
データセット設定条件
情報源
使用成績調査，厚生労働省，救済基金，特定使用成績調査，自発報告
第一報情報入手日 = BETWEEN ’20090101’ AND ’20150331’
国内外の区分区分 = ’ 国内’
情報媒体区分 <> ’CIOMS Form’
その他の条件（NULL 値や情報取扱い条件）
November 30, 2016 3 / 84

Part2 社内データベースの利用 CW5 内データ基礎統計値
全収集情状況
出力日 (Wed Nov 30 14:09:43 2016 )
情報源 CNT PCT
1 自発報告 127878 42.83
2 CIOMS （過去データ） 74725 25.03
3 文献・学会 39472 13.22
4 その他 14694 4.92
5 使用成績調査 13752 4.61
6 臨床試験（治験） 12527 4.20
7 特定使用成績調査 9774 3.27
8 臨床試験（製造販売後） 2446 0.82
9 厚生労働省 1465 0.49
10 救済基金 1204 0.40
11 感染症定期報告用文献・学会 330 0.11
12 規制情報 217 0.07
13 臨床試験（医師） 69 0.02
14 0 0.00
Table: 情報源の一覧とその割合
CW5ADR には，管理番号単位で全部で 225965 レコードが保存されている．
情報源で多いのは，自発報告 (127878，42.83%)，CIOMS（過去データ）(74725，25.03%)，文献・学会 (39472，13.22%) だった．
情報媒体区分で多いのは，CIOMS Form(169479 例,61.72%)，CIOMS Form( 治験)(31269 例,11.39%)，有害事象緊急連絡票 (18890 例,6.88%) だった．
November 30, 2016 4 / 84

Part2 社内データベースの利用 CW5 内データ基礎統計値
情報媒体区分
情報媒体区分 CNT PCT1 CIOMS Form 169479 61.722 CIOMS Form(治験) 31269 11.393 有害事象緊急連絡票 18890 6.884 文献・学会 6774 2.475 使用成績調査票 6719 2.456 特定使用成績調査票 5538 2.027 ICSR 5181 1.898 その他 5163 1.889 副作用・感染症調査票 5006 1.8210 有害事象調査票 3556 1.2911 特別調査調査票 3218 1.1712 副作用・感染症緊急連絡票 2738 1.0013 対応記録 2550 0.9314 中途終了書 2258 0.8215 調査要件確認連絡票(国内文献MR返信用) 1579 0.5716 救済基金 1219 0.4417 医薬品安全性情報報告書 619 0.2318 医薬品安全性情報報告書(結果回答書) 582 0.2119 症例個票 493 0.1820 製造販売後臨床試験症例報告書454 0.1721 重篤な有害事象に関する報告書264 0.1022 市販後臨床試験症例報告書 197 0.0723 安全性情報詳細調査票 160 0.0624 規制情報 150 0.0525 安全性情報の変更・追加報告書145 0.0526 臨床試験症例報告書 142 0.0527 Data Clariﬁcation Form 123 0.0428 医療機関報告詳細調査結果 70 0.0329 妊娠症例追跡調査票(出産時) 34 0.0130 妊娠症例追跡調査票(妊娠確認時) 18 0.0131 安全性情報の調査依頼書・回答書15 0.0132 重篤有害事象自発報告共通連絡票9 0.0033 胎児における有害事象調査票 1 0.0034 0 0.00
Table:情報媒体区分一覧とその割合
November 30, 2016 5 / 84

Part2 社内データベースの利用 CW5 内データ基礎統計値
対象データのサマリー
YEARMON CODE SOC PT YOBS RWNUM
1 2014 01: 411 CYM :3714 胃腸障害 :2439 悪心 : 434 Min. : 1.0 Min. : 1.0
2 2013 03: 362 PRS :2155 皮膚および皮下組織障害:2396 肝機能異常: 402 1st Qu.: 1.0 1st Qu.: 1.0
3 2009 06: 352 PT :1334 神経系障害 :2080 発疹 : 381 Median : 1.0 Median : 2.0
4 2013 07: 352 IRB :1265 臨床検査 :2020 肝障害 : 307 Mean : 1.4 Mean : 6.5
5 2009 07: 349 OXC :1064 精神障害 :1249 薬疹 : 304 3rd Qu.: 1.0 3rd Qu.: 8.0
6 2015 02: 349 RAC : 933 感染症および寄生虫症 :1241 下痢 : 298 Max. :60.0 Max. :66.0
7 (Other):17491 (Other):9201 (Other) :8241 (Other) :17540
November 30, 2016 6 / 84

Part2 社内データベースの利用 CW5 内データ基礎統計値
月の報告受領数
November 30, 2016 7 / 84

Part2 社内データベースの利用 CW5 内データ基礎統計値
サマリー解説
PT 単位で，月におよそ３００件のデータが発生し，もっとも多い薬剤は CYM,PRS，IRB
PRS は直後調査時に多量に報告されたことが影響？
PT は 1678 種類で悪心．肝機能異常など一般的なモノが最も多い
BETA，BETA0 は後に行うパラメータ推定に用いる十分統計量の各種「合計」
DENS PERDB は後に信頼性区間や情報量 I(θ) として用いる
集合論での濃度．この DB では 75 か月
November 30, 2016 8 / 84

Part2 社内データベースの利用 CW5 内データ基礎統計値
情報量基準で見れば粗密データベース
粗密データベース
PT の種類は 1678 で，薬剤の数は 172 だから PT 行 × 薬剤の表はセル数 288616 になるはずで
ある
対象 DB の中には 7266 （約 2.52%）しかセルが存在しない．
経時変化を見るために，さらに時間次元を加えて 3 次元とすると極めて疎な DB となる事には言を得
ない．
情報理論によれば，精度はモデル毎に定まる情報量（Fisher Information ）に反比例するため情報量が
少ない場合は統計理論上の推定精度が低下する．
これらが安全性情報を科学的に分析することを困難にする原因となっている．
November 30, 2016 9 / 84

Part2 社内データベースの利用 CW5 内データ基礎統計値
濃度全容：約 90%は６回未満／ 75 か月
(0,6] (6,12] (12,24] (24,36] (36,48] (48,75]
Ç»ÅÙ½¸·×¥°¥é¥Õ
´ü´Ö¡Ê·î¡Ë
(%)
0 20 40 60 80
   (0,6]   6690·ï (92.07%)
  (6,12]    332·ï (4.57%)
 (12,24]    163·ï (2.24%)
 (24,36]     41·ï (0.56%)
 (36,48]     23·ï (0.32%)
 (48,75]     17·ï (0.23%)
November 30, 2016 10 / 84

Part2 社内データベースの利用 CW5 内データ基礎統計値
予備知識： 「情報」とは
「情報」 という用語は日常使われるが， 難解な概念である．21 世紀においては３つの大きな定義がある．
Data Volume
一件二件，一枚二枚，K Byte, M Byte などの物理量的な量
Uncertenty
母数推定などで用いる推定精度を示す量 I(θ)
ガウス曲率から発展し，19 世紀に定義されたフィッシャーの情報量
その後これを基に標準誤差（S.D）が定義されてゆく．
Unexpectedness
情報伝達の不確実性を示す量．エントロピー I(E)
熱力学から発展し，20 世紀に定義されたシャノンの情報量
November 30, 2016 11 / 84

Part2 社内データベースの利用 CW5 内データ基礎統計値
λ = 2 推定の精度（標準誤差 S.E）と情報量
推定における精度・確からしさを示す量についてシミュレーションで示す．
●
●●
●
●
●●●
●
●
●●
●
●
●●
●
●
● ●
●
●
times6 times120 times600 times1.2k
1 2 3 4
1000²ó¥·¥ß¥å¥ì¡¼¥·¥ç¥ó)
lambda¿äÄêÃÍ
November 30, 2016 12 / 84

Part2 社内データベースの利用 CW5 内データ基礎統計値
社内安全性 DB の情報量的限界
P.10のグラフが示したように，我々は多くの場合，統計的に「6 サンプル程度で母数推定を行う」こと
が強いられている．この状況は情報量が乏しく当然推定誤差が大くなるという理解が重要．
120 サンプルで改善されているが，これは 10 年間蓄積した時に該当する．10 年間も態度を保留する
ことは，ビジネス的にあり得ない．我々は，たかだか過去 4,5 年のデータで今月・今季のことが知り
たいのである．
情報が乏しい状況で判断が必要なので，第一部で紹介した「新３例ルール」を各期ごとに見つづける
ことがこの低い情報量の現状を補うかもしれない．ある期間毎に 4 例以上の発生有りか否かを見るだ
けでスクリーニングになるだろう1．
November 30, 2016 13 / 84

Part2 社内データベースの利用 具体的シグナル値の話
社内データを分析する２大指標
現在，社内 DB を分析した指標として，以下を用意している
関係性の指標
アソシエーション分析と呼ばれるジャンルの指標．
全データ中のある薬剤・有害事象（PT）組み合わせで， 「今まで」を見る．
確率・発生傾向の指標
モデルベースの分析で，確率母数を基にする指標．
全データ中のある薬剤・有害事象（PT）組み合わせで， 「これから」を見る．
November 30, 2016 14 / 84

Part2 社内データベースの利用 関係性の指標
関係性の指標について
薬剤と有害事象の関係を定量的に見るための指標を紹介する．
関係性（相関性）を見る指標総論
ある事象とある事象の関係性を調べる指標は幾つも存在し，それぞれ特徴がある．
薬剤と有害事象の関係など，カテゴリカルデータの関係分析を一般にアソシエーション分析と
いう
φ 係数, コンテンジェンシー係数（クラマーの V，ピアソンの C）など
錠剤重量と含量の関係など，連続データの関係分析は一般に相関分析という
ピアソンの積率相関係数，順位相関係数（スピアマンの ρ，ケンドールの τ）など
November 30, 2016 15 / 84

Part2 社内データベースの利用 関係性の指標
薬剤と有害事象の関係性その指標 I
ある事象とある事象の関係性を調べる指標は幾つも存在し，それぞれ特徴がある．薬剤と有害事象と
などの関係はアソシエーション分析指標で評価される．
この指標は確率的な観点から幾つかの定義がある．
Reporting Ratios (RR) ：薬剤報告率の観点
RR = Pr ( AE |Drug )
Pr ( AE ) = Pr ( AE, Drug )
Pr ( AE ) Pr (Drug )
Proportional Reporting Ratios （PRR） ：相対リスクの観点
PRR = Pr ( AE |Drug )
Pr ( AE |¬Drug )
Reporting Odds Ratio （ROR） ：オッズ比の観点
ROR = Pr ( AE |Drug ) Pr (¬AE |¬Drug )
Pr (¬AE |Drug ) Pr ( AE |¬Drug )
November 30, 2016 16 / 84

Part2 社内データベースの利用 関係性の指標
薬剤と有害事象の関係性その指標 II
下記指標について，A を薬剤，B を有害事象確率とみなして定義を示す．
Support：A と B の同時確率
Suport = P( AB)
Conﬁdence：A が起きた時の B の条件付き確率
Conf idence = P(B|A)
Lift or Interest ：A が起きた時の B の条件確率と B 自体の確率の比．結論の B は前提の A とは
無関係に起こらないという指標である
Li f t= P( B| A)
P( B) ≡ P( AB)
P( A) P( B)
Conviction：排反事象に着目し, ルールが間違った予測をしてしまわないかどうかを意味する評
価指標である. conviction の値が大きければ, 前提 A であるときに結論が B ではないというこ
とが少なくなる．
Conviction = P( A) P(¬B)
P( A¬B)
Coverage：A のみの確率．そもそも A の発生確率自体がいくらか？ を示す．
Coverage = P( A)
Prevalence：B のみの確率．そもそも B の発生確率自体がいくらか？ を示す．
Prevalence = P(B)
Lift，Conviction は有用・信頼性が高いシグナルを発見できるとして多用される．その他，[14][Guillet
Hamilton] には 30 以上の指標が紹介されてる．
November 30, 2016 17 / 84

Part2 社内データベースの利用 関係性の指標
薬剤と有害事象の関係性その指標 III
RR，PRR，ROR の何を使えばよいのか？
「何を見たいのか？」により異なる．各指標の確率的定義から特性を理解して用いる．行政が ROR，
PRR を用いるのは「ある薬剤と他の薬剤」の関係を見たいからといえる．
また，疫学的なリスク比，オッズ比と定義が同じでなじみ深いこともあろう．
我々は何を見たいのだろうか？
一般に知りたいのは，ある有害事象の発生について， （見かけの）因果関係が，ある薬剤に認められる
か否かであろう．
RR は有害事象の発生確率 Pr ( AE) を分母に，薬剤投与条件下での発生確率 Pr ( AE |Drug ) を分子
にした比であるから，まさしくこれに該当する．
企業は RR で薬剤の（見かけの）因果関係を確認し，つづいて他剤比較に PRR を見るのがよかろう．
FDA と WHO は RR に少し工夫を施した指標をもちいている．
November 30, 2016 18 / 84

Part2 社内データベースの利用 関係性の指標
薬剤と有害事象の関係性その指標 IV
どれか一つの指標に絞ってよいか？
1995-2002 年に機械学習（組み合わせ最適化）領域の研究により， 「一つの指標で全てに合うモノはな
い」ことが証明されており（Ho and Pepyne ） ，これをノーフリーランチ定理（no-free-lunch
theorem、NFLT）という．
「あらゆる問題で性能の良い汎用最適化戦略は理論上不可能であり、
ある戦略が他の戦略より性能がよい のは、現に解こうとしている
特定の問題に対して特殊化（専門化）されている場合のみである」ことがわかっている．
この知見により，現代は複数の指標を用いて判断することが主流になり，これらの研究成果からアン
サンブル学習，弱学習という概念が実用化されている．自動ブレーキ，自動顔認識など社会応用例が
増えてきている．
安全管理部ニーズのすべてに合致させられる単一指標は存在しない のである．複数指標の組み合わせ
で解決する事が必要である．
There ain’t no such thing as a free lunch.
Robert Anson Heinlein(1907 - 1988)
November 30, 2016 19 / 84

Part2 社内データベースの利用 関係性の指標
薬剤と有害事象の関係性その指標 V
行政が用いるシグナル検出値が一番よいか？
PRR，ROR は PMDA，MHRA（England） ，Lareb（Dutch）などが使用している．其々に幾つか制限
があり，１）薬剤・有害事象同時頻度 ≥ 3or4，２）χ2 統計量 ≥ 3.84 などが満たされる必要がある
（PMDA 報告書@三菱総研，キッセイ DS 部会）しかし，[8, DSP ・松下] はシミュレーション結果か
ら感度が低く企業には向かないと報告している．
企業にとってベストではないことが文献化されているのに使う必要があるのだろうか．
企業はどんなシグナル検出値が一番よいか？
RR は FDA,WHO が用いる指標の基本となる指標であり，これは「薬剤の投与条件下の有害事象」と
「有害事象一般」の関係性指標である． 「 （みかけの）確率的因果関係」とも言われる．経済や心理学，
機械学習の領域で一般に用いられ LIFT 値 と言われる．
企業にとって，有害事象と薬剤の関係をシンプルに比較できるのでよい．
ちなみに，RR に対しても各種変法が存在し，WHO は混合二項分布，FDA は混合ポアソン分布とし
てベイズ流の条件確率を用いた指標をそれぞれ用いており，元をたどれば同じとみなせる．WHO の
評価指標 Information comportment は，IC = log2 RR と定義した量である．FDA は Empirical
Bayes Geometric Mean という混合分布の小さい λ の 5%分位点と定義した量を用いている．
医学・疫学統計領域では RR はリスク比 (Risk Ratio) と誤解されやすいので，本レポートでは LIFT
値と表記する．
November 30, 2016 20 / 84

Part2 社内データベースの利用 関係性の指標
薬剤と有害事象の関係性その指標 VI
企業はどんなシグナル検出値が一番よいか？
（2015 年 12 追記）EMA や FDA に RMP 分析システムを納入した実績のある ICT ベンダーのアリス
グローバル社と会談を持ち，この LIFT について紹介した．EBGM などは計算困難で解釈の困難な指
標であり MGPS にいたってはアルゴリズムが非公開．よりシンプルなこの比が良いと主張した．
FDA の担当窓口を通じ，FDA 事情を確認すると， 「FDA 内でも EBGM の解釈困難性から Simple
Bayes（SB）という指標で見ていこうという流れにある」と報告を受けた．論より根拠の URL 参照
SB ＝ Lift であり，本報告における概念は世界に通じる（た？ かもしれない． Yeah!!）
November 30, 2016 21 / 84

Part2 社内データベースの利用 関係性の指標
薬剤と有害事象の関係性その指標 VII
PT CODE ALPHA DENSITY LIFT PRR ZTP λ λ
1 スティーブンス・ジョンソン症候群 PLG A 25 20 15.27 21.03 0.46 0.33
2 スティーブンス・ジョンソン症候群 FMX A 16 16 5.57 6.60 0.03 0.21
3 スティーブンス・ジョンソン症候群 BKT-TA B 11 8 4.20 4.66 0.67 0.15
4 スティーブンス・ジョンソン症候群 VCM J 5 4 7.63 8.03 0.46 0.07
5 スティーブンス・ジョンソン症候群 VE G 4 4 5.17 5.37 0.03 0.05
6 スティーブンス・ジョンソン症候群 P T 4 2 1.09 1.09 1.59 0.05
7 スティーブンス・ジョンソン症候群 VCM P 3 2 39.89 41.27 0.87 0.04
8 スティーブンス・ジョンソン症候群 FM N 3 3 4.90 5.04 0.03 0.04
9 スティーブンス・ジョンソン症候群 CY M 3 3 0.13 0.10 0.03 0.04
10 スティーブンス・ジョンソン症候群 FMX C 2 2 5.88 5.99 0.03 0.03
11 スティーブンス・ジョンソン症候群 KR C 1 1 93.07 94.14 0.03 0.01
12 スティーブンス・ジョンソン症候群 PLG-IN T 1 1 55.84 56.48 0.03 0.01
13 スティーブンス・ジョンソン症候群 RD J 1 1 55.84 56.48 0.03 0.01
14 スティーブンス・ジョンソン症候群 MD S 1 1 25.38 25.66 0.03 0.01
15 スティーブンス・ジョンソン症候群 SG S 1 1 4.73 4.78 0.03 0.01
16 スティーブンス・ジョンソン症候群 N S 1 1 4.11 4.14 0.03 0.01
17 スティーブンス・ジョンソン症候群 BKT-GR A 1 1 2.49 2.51 0.03 0.01
18 スティーブンス・ジョンソン症候群 MD T 1 1 1.68 1.69 0.03 0.01
19 スティーブンス・ジョンソン症候群 EX J 1 1 1.18 1.18 0.03 0.01
20 スティーブンス・ジョンソン症候群 FB X 1 1 0.26 0.25 0.03 0.01
21 スティーブンス・ジョンソン症候群 RA C 1 1 0.19 0.18 0.03 0.01
November 30, 2016 22 / 84

Part2 社内データベースの利用 関係性の指標
薬剤の重篤性関係指標
シグナル検出値は一般的に薬剤 × 有害事象発生数を比較するモノと認識されている．事前確率がある
薬剤により変化した数量・重篤性・因果関係などを調べる指標としても各種の定義できる．
これは 事前確率 と 薬剤の条件付き確率 を各指標を基準に比べる事に該当する．いろいろな角度で
「みかけの因果関係」を調べることができる．
November 30, 2016 23 / 84

Part2 社内データベースの利用 関係性の指標
重篤性関係事例
肝障害に対して FBX の重篤性（見かけ上の）は 1.37 倍高い
この DB 中には腎障害全数 31 件中，17 例が重篤とされており，肝障害の重篤率は一般に
Pr ( AE重篤) = 17 ÷ 31 ≈ 0.548 だった．
FBX という薬剤条件下のそれは Pr ( AE重篤 |FBX ) = 3 ÷ 4 = 0.75 であり，率比が 0.75/0.548 ≈ 1.37
だから， 「肝障害に対してFBX の（見かけ上の）因果関係は 1.37 倍」となる．
CODE PT 薬剤重篤数 薬剤数 重篤数 有害事象全数
1 BKT-TAB 腎障害 3 7 17 31
2 CYM 腎障害 2 2 17 31
3 EX-ADU 腎障害 1 1 17 31
4 FBX 腎障害 3 4 17 31
重篤性のみならず，因果関係等についても薬剤 × 有害事象組み合わせ（全数数 7266 組）についてあらかじめ全て用
意することにより，簡便な意思決定の支援となるはずである．
November 30, 2016 24 / 84

Part2 社内データベースの利用 関係性の指標
最終データとその保管
マーケット領域の ABC 分析，RFM 分析の味付けをして最終資料とする．
CODE SOC PT First 致命転帰 DENS LIFT Recent 未知
1 ALT 感染症および寄生虫症 皮膚カンジダ 2011 07 0 1 668.45 2011 07 0
2 ALT 代謝および栄養障害 低血糖 2013 06 0 1 66.84 2013 06 1
3 ALT 内分泌障害 続発性副腎皮質機能不全 2013 06 0 1 121.54 2013 06 1
4 ALT 皮膚および皮下組織障害 光線過敏性反応 2014 09 0 1 3.54 2014 09 1
5 ALT 皮膚および皮下組織障害 接触皮膚炎 2009 06 0 10 342.00 2014 12 0
6 ALT 皮膚および皮下組織障害 皮膚刺激 2010 01 0 2 1069.52 2011 04 0
November 30, 2016 25 / 84

Part2 社内データベースの利用 ポアソン分布の特徴理解
パラメータ推定とその利用について
過去のデータから類推し， 「これから」を推定する指標について．
November 30, 2016 26 / 84

Part2 社内データベースの利用 ポアソン分布の特徴理解
再紹介 Poisson 分布の特徴
発生頻度やその変化を把握して，傾向変化を捉えて評価を行い，安全対策するのが，安全管理のミッ
ションといえる．
調査において基本的な分布モデルは Poisson 分布であることを紹介した．このモデルの性質を理解し
適切に活用する必要がある．
闇雲にデータをモデルに当てはめても意味がなく，モデルの選択自体が正しいこと確認することが重
要となる．厳密には難しいが．
モデルのパラメータが求まれば，リスクについてそのパラメータから定量的・客観的に判断できる．
薬剤 × 有害事象組み合わせについて情報理論（最尤法）又は，数値演算（反復法・EM Algorithm ）で
パラメータを求める方法も紹介するが，専門家以外は無視して良い．
November 30, 2016 27 / 84

Part2 社内データベースの利用 ポアソン分布の特徴理解
Poisson 分布の期待値
Poisson 分布のパラメータは一般に λ と記載される．この時に X 回の事象が発生する確率，期待値は
下記に従う．Poisson 分布の場合，対象データの平均と分散が等しいことが要求される．
Pr (X = x |λ) = λx
x! e−λ (x = 0, 1, 2, · · · , ∞)
E[X] =
∞∑
x=0
x λx
x! e−λ =
∞∑
x=1
x λx
x! e−λ
= λ ×
∞∑
x=1
λx−1
(x − 1)! e−λ = λ ×
∞∑
y=0
λy
y! e−λ
= λ
分散の導出ははやや複雑天下りに同 λ となる2．
Poisson 分布の期待値・分散は λ に等しい．これを実データで確認する．
November 30, 2016 28 / 84

Part2 社内データベースの利用 ポアソン分布の特徴理解
Poisson 分布の使い方 1
発生確率見積もり
ある薬剤 × 有害事象の組み合わせは 75 か月間で月平均 2.4 件だった．この時，ある月に 6 件報告を
受けた．
この 6 件報告の確率はいくらか？
Pr (X = x |λ) = λx
x! e−λ (1)
Pr (X = 6|λ = 2.4) = 2.46
6! e−2.4 ≈ 0.024
(1) に代入し，確率は ≈ 2.4%．
November 30, 2016 29 / 84

Part2 社内データベースの利用 ポアソン分布の特徴理解
Pr(X = 0, 1, · · · , 10|λ = 2.4) の確率
0 2 4 6 8 10
0.00 0.05 0.10 0.15 0.20 0.25
À¸µ¯¿ô
%
●
●
●
●
●
●
●
●
● ● ●
November 30, 2016 30 / 84

Part2 社内データベースの利用 ポアソン分布の特徴理解
Poisson 分布の使い方２
発生異常の見積もり
ある薬剤のある有害事象の報告は，75 か月間を見ると月平均 2.4 件の報告だった．
この情報の元，ある翌月 6 件の報告を得た．この 6 件を異常とすべきか？
∞∑
i≥6
Pr (xi |λ = 2.4) = 1 −
5∑
i=0
2.4xi
xi! e−2.4 (2)
≈ 0.036
最初に「異常」を定義する．月平均2.4 件の元，有意水準 (100 − α) = 0.05 として片側 5%を超える確
率の場合，異常とみなす a．
「6 件」以上発生する確率は，6, 7, · · · , ∞ と計算が困難だが確率公理より，１から「余事象」を引けば
良い．
(2) から， p ≤ 0.05 となり定義から「異常とすべき」となる．
a直接確率の検定を行ったことに該当
November 30, 2016 31 / 84

Part2 社内データベースの利用 ポアソン分布の特徴理解
Pr(X = 0, 1, · · · , 10|λ = 2.4) の累積確率
0 2 4 6 8 10
0.2 0.4 0.6 0.8 1.0
ÎßÀÑ³ÎÎ¨¡Êlambda=Ê¿¶Ñ2.4²ó¡Ë
À¸µ¯¿ô
%
●
●
●
●
●
●
● ● ● ● ●
95%
November 30, 2016 32 / 84

Part2 社内データベースの利用 ポアソン分布の特徴理解
社内 DB の分散対平均のグラフ
November 30, 2016 33 / 84

Part2 社内データベースの利用 ポアソン分布の特徴理解
CW5 内データの分散／平均比グラフ
(-Inf,0.75] (0.75,1.25] (1.25, Inf]
¥Ç¡¼¥¿ÆÃÀ­¤Î³ÎÇ§¥°¥é¥Õ
ÈæÎ¨¡ÊÊ¬»¶¡¿Ê¿¶Ñ¡Ë
%
0 20 40 60 80
(-Inf,0.75] (0.03%)
(0.75,1.25] (89.09%)
(1.25, Inf] (10.89%)
November 30, 2016 34 / 84

Part2 社内データベースの利用 ポアソン分布の特徴理解
CW5 内データの平均・分散・その比
±0.25 の変動を認めた場合，平均と分散が等しいとみなせる．
即ち薬剤 ×PT の組み合わせ約 91%は Poisson 分布を基にして推定が可能と強く推察される．
Poisson 分布のパラメータ推定から発生傾向の把握
評価対象期間での報告期待値の把握
上記をあらかじめ把握し，客観的なリスク評価ができるだろう．直接検定の枠組みで確率を求め評価
できる．
残りの約 9%については複雑な事例に該当し，複雑なモデルを用いる必要性があるかもしれない．
大多数である「約 90%はポアソン分布で予測可能」なのである．このパラメータを使えば良い．
November 30, 2016 35 / 84

Part2 社内データベースの利用 ポアソン分布の特徴理解
単純に Poisson 分布が使える事例＃１
Goodfit test (PRS-ÆÃÈ¯À­ÇÙÀþ°Ý¾É mean: 0.56 )
0
1
2
3
4
5
6
0 1 2 3
Number of Occurrences
sqrt(Frequency)
●
●
●
●
November 30, 2016 36 / 84

Part2 社内データベースの利用 ポアソン分布の特徴理解
単純に Poisson 分布が使える事例＃２
Goodfit test (FMXA-È¯¿¾ mean:0.64)
0
1
2
3
4
5
6
0 1 2 3
Number of Occurrences
sqrt(Frequency)
●
●
●
●
November 30, 2016 37 / 84

Part2 社内データベースの利用 ポアソン分布で説明困難な事象例
ポアソン分布で説明困難な事象例
約９０％はポアソン分布で片付くとして，残りはどうするか？
November 30, 2016 38 / 84

Part2 社内データベースの利用 ポアソン分布で説明困難な事象例
自発報告の収集事情（世の中単純じゃない）
医薬品の副作用報告は単純な調査報告とは異なる背景を持っている．
病気や副作用が起こらなかったら病院に行かない
０例情報が切断される．ゼロ切断ポアソンモデル（zero-truncated）
重篤な AE は報告されやすく，軽微な AE は報告されにくい
０例情報が増加する．ゼロ過剰ポアソンモデル（zero-inﬂated）
０例情報が減少する．ゼロ過少ポアソンモデル（zero-deﬂated）
これらの事情に対応するモデルを総称して，ゼロ修正ポアソンモデルという3．
WHO,FDA が用いる複数パラメータ，潜在パラメータを含むモデルが必要かもしれない．
過分散・疎分散に対応するモデル
Gamma Poisson 分布（ベイズの枠組み）
幾何分布，負の二項分布
混合分布モデル
潜在クラスモデル（Latent Parameter Model ）
November 30, 2016 39 / 84

Part2 社内データベースの利用 ポアソン分布で説明困難な事象例
複雑なデータ事例 1-1：PRS の悪心
PRS-°­¿´(mean:2.51)
Êó¹ð¿ô/MONTH
COUNT
0 5 10 15
0 10 20 30 40
ÍýÏÀÌ©ÅÙ
·Ð¸³Ì©ÅÙ(É¸ËÜÊ¬ÉÛ)
November 30, 2016 40 / 84

Part2 社内データベースの利用 ポアソン分布で説明困難な事象例
複雑なデータ事例 1-2：PRS の悪心
Goodfit test (PRS-°­¿´ mean:2.51)
-2
-1
0
1
2
3
4
0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16
Number of Occurrences
sqrt(Frequency)
●
●
●
●
●
●
●
●
● ● ● ● ● ● ● ● ●
November 30, 2016 41 / 84

Part2 社内データベースの利用 ポアソン分布で説明困難な事象例
複雑なデータ事例 2-1：CYM の不眠症
CYM-ÉÔÌ²¾É(mean:3.11)
Êó¹ð¿ô/MONTH
COUNT
0 2 4 6 8 10 12 14
0 10 20 30 40
ÍýÏÀÌ©ÅÙ
·Ð¸³Ì©ÅÙ(É¸ËÜÊ¬ÉÛ)
November 30, 2016 42 / 84

Part2 社内データベースの利用 ポアソン分布で説明困難な事象例
複雑なデータ事例 2-2：CYM の不眠症
Goodfit test (CYM-ÉÔÌ²¾É mean:3.11)
-2
-1
0
1
2
3
4
0 1 2 3 4 5 6 7 8 9 10 11 12 13 14
Number of Occurrences
sqrt(Frequency)
●
●
● ●
●
●
●
●
●
● ● ● ● ● ●
November 30, 2016 43 / 84

Part2 社内データベースの利用 ポアソン分布で説明困難な事象例
複雑なデータ事例 3-1：PRS の光線過敏性反応
PRS-¸÷Àþ²áÉÒÀ­È¿±þ(mean:4.19)
Êó¹ð¿ô/MONTH
COUNT
0 5 10 15
0 5 10 15 20 25 30 35 ÍýÏÀÌ©ÅÙ
·Ð¸³Ì©ÅÙ(É¸ËÜÊ¬ÉÛ)
November 30, 2016 44 / 84

Part2 社内データベースの利用 ポアソン分布で説明困難な事象例
複雑なデータ事例 3-2：PRS の光線過敏性反応
Goodfit test (PRS-¸÷Àþ²áÉÒÀ­È¿±þ mean:4.19)
-2
-1
0
1
2
3
0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16
Number of Occurrences
sqrt(Frequency)
●
●
●
● ●
●
●
●
●
●
●
● ● ● ● ● ●
November 30, 2016 45 / 84

Part2 社内データベースの利用 複雑な事象に対応するモデル
複雑な事象に対応するモデルの概略・雑 I
過分散を示した約 9%を見ると，P. 43の CYM，P. 45 の PRS 例が示すようにポアソン分布から，ず
れが確認されるモノや多峰性を示すモノがあるようだ．モデルを変える必要があるかもしれない．
ポアソン分布からのずれが確認されるモノ
ゼロ修正モデルについては，すでに薬業では岩崎と中外，エーザイのそれぞれが共同研究している．それ
ら先行研究によれば，ゼロ修正モデルは医薬品有害事象やマーケティング領域で有効だろうことを述べて
いる．詳しくは専門書にゆずり，このモデルは海外で数理的に zero-Inﬂated（ゼロ過剰）モデルや
zero-Hurdle（ゼロハードル）モデルとも呼ばれる．利用するだけなら難しくない．
多峰性を示すモノ
通常用いられる確率分布は、一様分布を除けば、全て、一つの峰を持った分布である．ところが、実務に
おいては，二つ以上の峰を持った分布を考えねばならない場合がある．このようなとき，一番単純なモデ
ルは一つの峰を持った分布を必要な数だけそろえ，そのそれぞれにウェイトをかけて，たし合わせたもの
である． 「必要な数」が測定不能なので潜在パラメータとなる．こういった「測定できない」モノの仮定は
現代社会ではおかしなことではなく，そもそも調査が実現できないマーケティング分野や社会心理学で古
くから利用されている．現代では利用は難しくない．
November 30, 2016 46 / 84

Part2 社内データベースの利用 複雑な事象に対応するモデル
複雑な事象に対応するモデルの概略・雑 II
ゼロ修正モデルは， 「０」の度数に潜在クラスを仮定している．WHO の BCPNN，FDA の MGPS が
採用しているシグナル検出値は潜在クラスを仮定した混合分布である．
クラス数は２つとは限らないが FDA も WHO も最も基本的な 2 クラスを仮定し，パラメータ a,b
（a>b）の小さい側の b を用いて算出した期待値でリスク評価している．
近年，EM アルゴリズム（Dempster, A.P., Laird, N.M., Rubin, D.B., 1977 ）という数理理論の発達
により，潜在モデルの推定が容易になってきている．後に事例を紹介するこの反復法は時間を要する
が初期値問題から逃れられるなど性質の良い点を評価して，今回の推定で用いている．
従来の数値最適化ライブラリで潜在モデルを推定すると，ニュートン法を主としたモノのため，収束
は高速だが，初期値により推定結果に差異がでる．初期値の設定が難しく山口のような素人では使い
にくかった．
November 30, 2016 47 / 84

Part2 社内データベースの利用 ゼロ修正ポアソン分布
修正モデル（ゼロ切断ポアソン分布） I
一般化切断ポアソン分布は
P(x |x ≥ k) = Pr (X = x |X ≥ k) = 1
Pr (X ≥ k) × λx
x! e−λ
=
λx
x! e−λ
∑∞
y=k
λy
y! e−λ
「調査」は有害事象が発生せねば医師にかからないことから，ゼロ切断となる．k = 1 すなわち X ≥ 1
がゼロ切断されたポアソン分布となるので，
p(x |x ≥ 1) = λx e−λ /x!
1−e−λ (3)
= λx e−λ
x!(1−e−λ ) = λx
x!(eλ − 1) (4)
(3) は 確率の公理から導出され， ∑∞
y=1
λy
y! e−λ = 1 − e−λ から，(4) となる．
これをゼロ切断ポアソン分布 (ZTP:Zero-truncated Poisson Distribution) と呼ぶ．
November 30, 2016 48 / 84

Part2 社内データベースの利用 ゼロ修正ポアソン分布
修正モデル（ゼロ切断ポアソン分布） II
ZTP の期待値，分散の導出は専門書（[2][岩崎 P.157]）によると，
E[X |X ≥ 1] = λ
1−e−λ (5)
V[X |X ≥ 1] = λ
1−e−λ − λ2 e−λ
(1−e−λ )2 (6)
(5) と (6) から ZTP では分散 < 期待値であり分散／期待値は１以下になる．
（P.28で Poisson 分布の場合，分散 = 期待値すなわち分散 œ 平均＝１を確認した）
November 30, 2016 49 / 84

Part2 社内データベースの利用 ゼロ修正ポアソン分布
ZTP 確認用 CW5 内データの分散／平均比
(-Inf,0.75] (0.75,1] (1,1.25] (1.25, Inf]
¥Ç¡¼¥¿ÆÃÀ­¤Î³ÎÇ§¥°¥é¥Õ
ÈæÎ¨¡ÊÊ¬»¶¡¿Ê¿¶Ñ¡Ë
%
0 20 40 60 80
(-Inf,0.75] (0.03%)
(0.75,1] (85.48%)
(1,1.25] (3.61%)
(1.25, Inf] (10.89%)
分散／期待値 ≤ 1・・・おどろくべき結果である．ゼロ切断を示すモノは多いようだ．November 30, 2016 50 / 84

Part2 社内データベースの利用 ゼロ修正ポアソン分布
ZTP を物語る証拠？
もし 0.75 から 1.25 の区間を中心の 1 で区切った時，中心極限性により 1 以上：1 以下は 50:50 にな
る．しかし約 96 対 4 となっている4．
打ち切りおよびトランケーションの下でのパラメータ推定に及ぼす切断点の影響評価，
岩崎 学 (成蹊大学理工学部情報科学科),
阿部 貴行 (万有製薬株式会社臨床医薬研究所生物統計部統計解析課)[5]
ゼロ修正されたポアソン分布におけるゼロ修正パラメータの統計的推測，大道寺 香澄（エーザイ
株式会社コーポレートメディカルアフェアーズ本部安全管理部） ，岩崎 学[6]
先達の慧眼に恐れ入るところである．岩崎氏は肩書が医薬品医療機器総合機構 専門委員や日本計量生
物学会の理事さまなど豪華絢爛なエライ先生である．同じ学さんでもエライ違いである．
ありがたく研究成果をちょうだいさせて頂き，自分のビジネスに応用することとする．
November 30, 2016 51 / 84

Part2 社内データベースの利用 パラメータ推定プログラム
ZTP のパラメータ推定（EM 事始め） I
理論がわかってもパラメータを求められなければ，ビジネスにならない．
確率密度函数 p(x|θ) の θ ベクトルを推定する問題は尤度推定問題と呼ばれ微分を用いて解くのが
基本．
N ＋ M 個のデータ x と y が未知パラメータ θ ベクトルを持つとし，y が観測できなかったとする．
この欠損データを含むデータを不完全データと呼ぶ．
この不完全データの確率密度函数 p(x, y|θ) の θ ベクトルを推定する問題は微分方程式が陽に解けな
い．よってコンピュータ科学や工学の知識を使って数値計算で求める．
November 30, 2016 52 / 84

Part2 社内データベースの利用 パラメータ推定プログラム
ZTP のパラメータ推定（EM 事始め） II
不完全データに対しては尤度推定ができないので，不明な y について積分すると p(x|θ) が得られる．
log p(x|θ) = log
∫
y p(x, y|θ)dy (7)
そして計算がらくな対数尤度を最大にする θ を推定するという戦略に変える．
周辺化，積分消去
多変量の確率密度関数のある変数について，
取りうる範囲に渡り積分したモノは残りの変数に関する確率密度を表す．この確率分布は周辺分布と
いい，この操作 (7) を周辺化と呼ぶ．
p(x|θ) =
∫
· · ·
∫
p(x, y|θ)dy1 · · · dyM
=
∫
y p(x, y|θ)dy
不完全データからの最尤推定は，欠測データに関して周辺化を行って観測データのみの周辺分布を作
り，それに対する最尤推定を行うことになる．すなわち周辺分布密度関数に観測データを代入した尤
度を最大にする（[13][金谷 P.153]） ．
(7) は直接計算が困難だが，それを EM Algorithm で解くことができる．
November 30, 2016 53 / 84

Part2 社内データベースの利用 パラメータ推定プログラム
ZTP のパラメータ推定（EM 事始め） III
Procedure EM( p(x, y|θ))
1 未知パラメータ θ の初期値 θ(0) を与え，K = 0 とする
2 E-step として関数を計算する
QK (θ) = Ey|x, θ (K) [log p(x, y|θ)] (8)
3 M-step として QK (θ) を最大にする θ を θ(K+1) とする
4 K = K + 1 として E-step に戻り，収束するまで反復
November 30, 2016 54 / 84

Part2 社内データベースの利用 パラメータ推定プログラム
ZTP のパラメータ推定（EM 事始め） IV
E-step(8) の関数
QK (θ) = Ey|x, θ (K) [log p(x, y|θ)]
は「パラメータが θ の時にデータ x, y を同時に観察する同時確率密度は，仮定により p(x, y|θ) と表
せる．
この時，データ x が観測された時（とすれば） ，欠測データy が取り得る値 の可能性を与える y の事
後確率密度はベイズの定理より，
p(y|x, θ ) = p(x, y|θ)∫
p(x, y|θ)dy
(9)
パラメータが θ であり x が得られた時の条件付き確率は (9)．
(8) の対数尤度の期待値は， 「(9) の θ に反復過程で直前に計算した θK を代入した p(y|x, θ K )」に
関する期待値となる．
November 30, 2016 55 / 84

Part2 社内データベースの利用 パラメータ推定プログラム
ZTP のパラメータ推定（EM 事始め） V
Proof.
(7) の対数尤度を θ で微分すると
∇θ log p(x |θ) =
∇θ
∫
p(x,y|θ) dy∫
p(x,y|θ) dy =
∫ ∇θ p(x,y|θ)∫
p(x, ´y|θ) d´y d´y
=
∫ ∇θ p(x,y|θ)
p(x,y|θ)
p(x,y|θ)∫
p(x, ´y|θ) d´y dy
=
∫
∇θ log p(x, y|θ) p(y|x, θ )dy
(10) は (9) から導かれ，その中の p(y|x, θ ) の θ を θK と書き直す．
∫
∇θ log p(x, y|θ) p(y|x, θ (K) )dy = ∇θ
∫
log p(x, y|θ) p(y|x, θ (K) )dy
= ∇θ Ey|x, θ (K) [log p(x, y|θ)] = ∇θ QK (θ) (10)
(10) を０にすることは， (8) の函数 QK (θ) の極値を計算する意味になる． □
November 30, 2016 56 / 84

Part2 社内データベースの利用 パラメータ推定プログラム
ZTP のパラメータ推定
EM Algorithm を正しく理解したとして？ ZTP のパラメータを算出する．
観測されない Pr (X = 0|λ) の時の度数を f0 と置く．観測されたデータの度数を m と置く．
完全データは n = f0 + m．P. 28の Poisson 分布より f0 = ne−λ ．
DB のクエリで window 集計された x ≥ 1 のデータの和は ω = x1 + · · · + xm と表記できる．
l(λ) = log
f0+m∏
i=0
λx
xi
e−λ (11)
= (log λ)ω −
f0+m∑
x=0
log(xi!) − ( f0 + m)λ (12)
E[ ˆf0] = ( f0 + m)eλ (13)
E[ ˆλ] = ω
f0+m (14)
完全データが得られたときの条件付き確率 (E-step) は (13) の ˆf 0
0 を適当な初期値 0 で推定し， 得ら
れた値を (14) にて λ1 を推定する．λ1 から再度反復して f 1
0 と更新する．これを収束するまで繰り
返す．
November 30, 2016 57 / 84

Part2 社内データベースの利用 パラメータ推定プログラム
スティーブンス・ジョンソン症候群 ZTP 推定事例
FMXA のスティーブンス・ジョンソン症候群 (S.J.) について推定する．
CodePT は FMXA の S.J. が合計「16 例」事例報告されたことを示す（CodePT の total sum ） ．
DENSITY は S.J. が月単位で合計「16 回」報告されたことを示す（YEARMON の count） ．
YEARMON CODE PT CNT ICSRS MONTH CodePT Dtot DENSITY
1 2009 05 FMXA スティーブンス・ジョンソン症候群 1 11 16 816 16
2 2009 06 FMXA スティーブンス・ジョンソン症候群 1 18 16 816 16
3 2009 12 FMXA スティーブンス・ジョンソン症候群 1 9 16 816 16
4 2010 04 FMXA スティーブンス・ジョンソン症候群 1 26 16 816 16
5 2011 07 FMXA スティーブンス・ジョンソン症候群 1 9 16 816 16
6 2011 09 FMXA スティーブンス・ジョンソン症候群 1 8 16 816 16
7 2012 02 FMXA スティーブンス・ジョンソン症候群 1 16 16 816 16
8 2012 10 FMXA スティーブンス・ジョンソン症候群 1 15 16 816 16
9 2012 12 FMXA スティーブンス・ジョンソン症候群 1 9 16 816 16
10 2013 10 FMXA スティーブンス・ジョンソン症候群 1 8 16 816 16
11 2014 02 FMXA スティーブンス・ジョンソン症候群 1 10 16 816 16
12 2014 03 FMXA スティーブンス・ジョンソン症候群 1 15 16 816 16
13 2014 11 FMXA スティーブンス・ジョンソン症候群 1 6 16 816 16
14 2014 12 FMXA スティーブンス・ジョンソン症候群 1 12 16 816 16
15 2015 01 FMXA スティーブンス・ジョンソン症候群 1 18 16 816 16
16 2015 02 FMXA スティーブンス・ジョンソン症候群 1 5 16 816 16
統計的知識があれば，パラメータ推定はこの２種類の情報だけで推定できることがわかる．
この性質を「十分統計量」といい，これを利用すると SQL DB の負荷を減らし素早く計算できる
（統計 ⇒ 支援 ⇒ エンジニアリング ⇒ 実現） ．
November 30, 2016 58 / 84

Part2 社内データベースの利用 パラメータ推定プログラム
ZTP パラメータ推定プログラム例
EMZIP <- function(ALPHA=CodePT,DENS_PERDB=DENSITY){
w <- unique(ALPHA) # w: >0 の data sum
m <- unique(DENS_PERDB)# m: 不完全データの観測回数
f0 <- 0 # f0: ０切断の数
lambda0 <- w/m # 初期値
lambda1 <- w/m
eps <- 10e-6 # 終了条件（７ケタ以上だと終わらない）
cnt <- 0 # 非収束対策カウンター
while(1){
f1 <- (m+f0)*exp(-lambda0) # E-step
lambda1 <- w/(m + f1) # M-step
if(abs(lambda0 -lambda1) < eps || abs(f1 -f0) < eps) break
# 収束判定は LogLiklyhood 判定でも OK．
f0 <- f1
lambda0 <- lambda1
if(cnt > 10000) break #Divergence 予防．1000 だと収束条件に不足
cnt <- cnt+1
}
# printf(" iteration was %.0f\n",cnt)# Debug Print Orz
{return(lambda1)}
}
November 30, 2016 59 / 84

Part2 社内データベースの利用 パラメータ推定プログラム
自然な推定値と EM 推定推移
この DB は 75 か月間のデータであり，自然な平均は 16
75 ≈ 0.21 である．同自然な分散は 0.17 であ
り，分散／平均の比はおよそ 0.79 と１以下になる．
先のプログラムを用いて推定すると反復の後，設定精度に達して収束し0.0272 と ZTP の λ 推定値を
得る．この事例は分散が極めて小さい（情報量が少ない）ため，収束条件が極めて難しい．このため，
１０００回以上の反復が必要だった．
> EMZTPitrCounter(16, 16)
iteration(0) eps 0.26894142 欠測値 5.8861
iteration(1) eps 0.12810263 欠測値 10.5359
iteration(2) eps 0.07871377 欠測値 14.5202
...
...
iteration(1369) eps 0.00001001 欠測値 571.5895
iteration(1370) eps 0.00001000 欠測値 571.8054
iteration(1371) eps 0.00000999 欠測値 572.0212
iteration was 1371
$lambda
[1] 0.0272
$f0
[1] 572
November 30, 2016 60 / 84

Part2 社内データベースの利用 パラメータ推定プログラム
Poisson 分布の使い方 3
パラメータによる他剤比較
ZTP のパラメータを同一有害事象 × 薬剤間で比較すればその有害事象の 見かけの因果関係 を比較で
きるもしれない．
PT CODE CodePT DENSITY ZTPlambda NORlambda variance ratioV E
1 スティーブンス・ジョンソン症候群 PT 4 2 1.59 0.05 0.13 2.45
2 スティーブンス・ジョンソン症候群 VCMP 3 2 0.87 0.04 0.07 1.63
3 スティーブンス・ジョンソン症候群 BKT-TAB 12 9 0.61 0.16 0.24 1.51
4 スティーブンス・ジョンソン症候群 VCMJ 5 4 0.46 0.07 0.09 1.33
5 スティーブンス・ジョンソン症候群 PLGA 28 23 0.41 0.37 0.39 1.06
6 スティーブンス・ジョンソン症候群 CYM 3 3 0.03 0.04 0.04 0.96
7 スティーブンス・ジョンソン症候群 FMN 3 3 0.03 0.04 0.04 0.96
8 スティーブンス・ジョンソン症候群 FMXA 16 16 0.03 0.21 0.17 0.79
9 スティーブンス・ジョンソン症候群 BKT-INT 4 4 0.03 0.05 0.05 0.95
10 スティーブンス・ジョンソン症候群 VEG 4 4 0.03 0.05 0.05 0.95
11 スティーブンス・ジョンソン症候群 EXJ 2 2 0.03 0.03 0.03 0.97
12 スティーブンス・ジョンソン症候群 FMXC 2 2 0.03 0.03 0.03 0.97
13 スティーブンス・ジョンソン症候群 BKT-GRA 1 1 0.03 0.01 0.01 0.99
14 スティーブンス・ジョンソン症候群 FBX 1 1 0.03 0.01 0.01 0.99
15 スティーブンス・ジョンソン症候群 FMX-INT 1 1 0.03 0.01 0.01 0.99
16 スティーブンス・ジョンソン症候群 KRC 1 1 0.03 0.01 0.01 0.99
17 スティーブンス・ジョンソン症候群 MDS 1 1 0.03 0.01 0.01 0.99
18 スティーブンス・ジョンソン症候群 MDT 1 1 0.03 0.01 0.01 0.99
19 スティーブンス・ジョンソン症候群 NS 1 1 0.03 0.01 0.01 0.99
20 スティーブンス・ジョンソン症候群 PLG-INT 1 1 0.03 0.01 0.01 0.99
21 スティーブンス・ジョンソン症候群 RAC 1 1 0.03 0.01 0.01 0.99
22 スティーブンス・ジョンソン症候群 RDJ 1 1 0.03 0.01 0.01 0.99
23 スティーブンス・ジョンソン症候群 SGS 1 1 0.03 0.01 0.01 0.99
Table: S.J. について ZTP 母数による薬剤間剤比較
November 30, 2016 61 / 84

Part2 社内データベースの利用 ゼロ過剰ポアソンモデルパラメータ推定
ゼロ修正モデルからのゼロ過剰ポアソンモデル
ゼロ修正されたポアソンモデルは Pr (y|λ, ω) 次のように定義される．
Pr (y|λ, ω) =

ω + (1 − ω)eλ (x = 0)
(1 − ω)λx e−λ
x! (x ≧ 1)
ω は定数であり 0 ≤ Pr (X = 0) ≤ 1 と制限される．詳しくは専門書に譲り，この修正ポアソンモデル
は結論的にゼロ過剰ポアソンモデルに帰着し，０のみを確率１とする一点分布I0 (x) と ω : (1 − ω) の
混合分布である ωIo (x) + (1 − ω) Poisson (λ) となる．
これをゼロ過剰ポアソン分布（ZIP:Zero-Infrated Poisson Distribution ）と呼ぶ．
November 30, 2016 62 / 84

Part2 社内データベースの利用 ゼロ過剰ポアソンモデルパラメータ推定
ゼロ過剰ポアソンモデルの尤度関数
ZIP の尤度関数 L(λ, ω) は f0 を０度数とし，独立ｎ個の観測 x1, x2, · · · , xn とした時の尤度関数は，
L(λ, ω) = {ω + (1 − ω)e−λ }f0
∏
y≥1
{(1 − ω)λyi e−λ ⧸yi!}
となって陽に解けない．
そこで未知の観測度数を M とすると，完全データの尤度関数は，
L(λ, ω) = ωn−M ∏M
i=1 (1 − ω)λxi e−λ ⧸xi!
= ωn−M (1 − ω) M e−Mλλ
∑M
i=1 xi ⧸ ∏M
i=1 xi (15)
なので (15) の尤度関数を解く．
November 30, 2016 63 / 84

Part2 社内データベースの利用 ゼロ過剰ポアソンモデルパラメータ推定
ZIP の E ステップ
(15) の対数尤度は，観測された値の和を A =
M∑
i=1
xi =
∑
x≥1
xi と書き直せば，
l(λ, ω) = (n − M) log ω + M log(1 − ω) − Mλ + Alog λ − log ∏M
i=1 xi! (16)
(16) を偏微分して ∂l(λ,ω )
∂λ = ∂l(λ,ω )
∂ω = 0 より尤度方程式を得る．
∂l(λ, ω)
∂λ = −M + A
λ = 0
∂l(λ, ω)
∂ω = n−M
ω − M
1−ω = 0
M-step は，完全データの λ と ω の最尤推定値を求めるから，
ˆλ = A
M , ˆω = 1 − M
n
となる．
November 30, 2016 64 / 84

Part2 社内データベースの利用 ゼロ過剰ポアソンモデルパラメータ推定
EM Algorithmによる反復パラメータ推定 I
E-step は下記になる．
ˆλ = A
M (M − step )
ˆω = 1 − M
n (M − step )
λ が与えられたとき，y = 1 以上の観察カウントを m とすると，ゼロカウントにおける Poisson 分布
部分の期待値は Me−λ であるので， M = m + Me−λ より M-step は下記となる．
ˆM = m
1−e−λ (E − step )
m は DB から SQL window 関数で count 関数をラップして算出し，E-step の定数として用いる．
November 30, 2016 65 / 84

Part2 社内データベースの利用 ゼロ過剰ポアソンモデルパラメータ推定
EM Algorithmによる反復パラメータ推定 II
実際の推定においては，初期値 ˆM0 として m を用いる（[2][岩崎，P165]） ．得られたM1 を代入し
（E-step） ，λ1，ω1 を求める（M-step）
得られた λ1 を再度 E-step に代入し，逐次反復法により計算する．収束条件は対数尤度，情報量基準
（AIC，BIC など）が設定され，その差 ≤ ϵ により終了判定させる．
ZTP のパラメータは P.59のプログラムで得られる ZTP 推定値 ˆλ を用い， ˆM = m
1−e ˆλ から ˆM をもと
め，最後に ˆω = 1 − ˆM
n を求めることが証明されているので，再利用すればデータ処理時間を短縮で
きる．
November 30, 2016 66 / 84

Part2 社内データベースの利用 ゼロ過剰ポアソンモデルパラメータ推定
ZIP のパラメータ推定
擬似コード
ZIPestimate <-function(lambda, n= SumOfAE, m= CountOfAE){
M = m/(1-exp(-lambda))
w = 1 - M/n
hoge hoge
fuga fuga
（混合率の t-検定により，過剰パラメータωの妥当性を見る）
（省略）
November 30, 2016 67 / 84

Part2 社内データベースの利用 ゼロ過剰ポアソンモデルパラメータ推定
渡辺による EM Algorithmの利点
EM Algorithm は，不完全データから最尤推定値を導くための統一的な framework であり，反復回数
が多いことなどの問題点が指摘されていたが，framework の単純性と収束の安定性，適用モデルの汎
用性などの利点が勝り，今日に至るまでに，工学・医学・社会学・経営学など統計モデルが必要とさ
れるほぼすべての分野で用いられる．
渡辺 [12, p.228] によると，
もし，f (y|θ) が，多項分布，ポアソン分布，正規分布などの指数分布族の範疇に入るモデル
であれば，E-step と M-step は θ の十分統計量 t = t(x) を媒介にしたステップに置き換え
ることができ，更に分かり易くなる．
ポアソン分布の十分統計量は合計だから，都合の良いことに社内 DB から SQL 集計関数や Window
関数を用いれば 5 ケタの DB なら 1 分をも必要としない．RDBM が Oracle なので両者が使えるのも
好都合である．また，
EM アルゴリズムでは，とくに完全データが指数分布族の範疇であれば，各ステップにおけ
る出力が統計的に意味のあるものになっている．すなわち，自然にパラメータの定義域や制
約条件が充たされ，かつ容易に制約条件を組み込んで解を得ることができる．いわゆる不適
解が出ない．
Poisson 分布は指数分布族なので，不適解が出ないのも好都合であり今回のプログラムは，パラメータ
ベクトルの前後差が 10−6 以下である時に収束と判定しているが，理論的に問題がない．またこの反復
法は初期値の影響を受けにくい仕組みになっており，反復により推定値の精度が上がる5．
November 30, 2016 68 / 84

Part2 社内データベースの利用 ゼロ過剰ポアソンモデルパラメータ推定
不備：PRS 光線過敏症の混合分布ぐあい
0 10 20 30 40 50 60
5 10 15
PRS¸÷Àþ²áÉÒÀ­È¿±þ
Index
count
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●●
●●
●
●
●
●
●
●
●
●
●
●●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●
November 30, 2016 69 / 84

Part2 社内データベースの利用 ゼロ過剰ポアソンモデルパラメータ推定
不備：CYM-傾眠の混合分布ぐあい
0 10 20 30 40 50 60
0 5 10 15 20 25 30
CYM-·¹Ì²
Index
count
●●
●
●●●
●●
●●
●●●●
●●●
●
●
●●●●●●●
●●
●
●●
●●●
●●●●
●
●
●●●
●
●●
●
●
●
●
●
●●●
●●
●
●●●
November 30, 2016 70 / 84

Part2 社内データベースの利用 ゼロ過剰ポアソンモデルパラメータ推定
有害事象の数理を Simulation で理解する
いままでの説明をシミュレーションで「長期間の推移」を再現してみよう！
November 30, 2016 71 / 84

Part2 社内データベースの利用 ゼロ過剰ポアソンモデルパラメータ推定
有害事象報告のシミュレーション
0 10 20 30 40 50 60 70
0.0 0.5 1.0 1.5 2.0 2.5 3.0
·îÊ¿¶Ñ0.1²ó¤ÎÍ­³²»ö¾ÝÎã¥·¥ß¥å¥ì¡¼¥·¥ç¥ó
Index
dat
November 30, 2016 72 / 84

Part2 社内データベースの利用 ゼロ過剰ポアソンモデルパラメータ推定
５例集積されたら． ． ．は如何に無駄な手順か！
0 20 40 60 80 100
0 1 2 3 4 5 6 7
´üÂÔÃÍ¡áÉÑÅÙ¥Ñ¥é¥á¥¿¡ö´ü´Ö¤À¤«¤éÉ¬¤º¸¡Æ¤¤¬É¬Í×¡¥¡¥¤Î¿Þ
Index
dat
発生傾向が一定でも，時間の経過
と共に報告事例は増える（あたりまえ）. 添付文書が？？？ になる理由である． November 30, 2016 73 / 84

Part2 社内データベースの利用 ゼロ過剰ポアソンモデルパラメータ推定
0 20 40 60 80
0 1 2 3 4 5 6 7
ÉÑÅÙº®¹ç¥·¥ß¥å¥ì¡¼¥·¥ç¥ó(Ê¬³ä»þ´üÌ¤ÃÎ)
Index
dat
November 30, 2016 74 / 84

Part2 社内データベースの利用 ゼロ過剰ポアソンモデルパラメータ推定
0 20 40 60 80
0 1 2 3 4 5 6 7
ÉÑÅÙº®¹ç¥·¥ß¥å¥ì¡¼¥·¥ç¥ó(Ê¬³ä»þ´üÌ¤ÃÎ)
Index
dat
November 30, 2016 75 / 84

Part2 社内データベースの利用 ゼロ過剰ポアソンモデルパラメータ推定
0 20 40 60 80
0 1 2 3 4 5 6 7
ÉÑÅÙº®¹ç¥·¥ß¥å¥ì¡¼¥·¥ç¥ó(Ê¬³ä»þ´üÌ¤ÃÎ)
Index
dat
November 30, 2016 76 / 84

Part2 社内データベースの利用 ゼロ過剰ポアソンモデルパラメータ推定
0 20 40 60 80
0 1 2 3 4 5 6 7
ÉÑÅÙº®¹ç¥·¥ß¥å¥ì¡¼¥·¥ç¥ó(Ê¬³ä»þ´ü´ûÃÎ¡Ê¿å¿§¡Ë)
Index
dat
November 30, 2016 77 / 84

Part2 社内データベースの利用 ゼロ過剰ポアソンモデルパラメータ推定
0 20 40 60 80
0 1 2 3 4 5 6 7
ÉÑÅÙº®¹ç¥·¥ß¥å¥ì¡¼¥·¥ç¥ó(Ê¬³ä»þ´ü´ûÃÎ¡Ê¿å¿§¡Ë)
Index
dat
November 30, 2016 78 / 84

Part2 社内データベースの利用 第二部のまとめ
第二部のまとめ I
シグナル検出について EMA Guidline には次の記載がある．
期待されること
データマイニング手法が適切に運用されるとき，ともすれば検出されなかった，あるいは実際にはよ
り遅く検出されたであろういくつかのシグナルを検出することができ，ファーマコビジランスプログ
ラムの効率を高めるかもしれない。
留意事項
シグナル検出プログラムへ統計学的データマイニング手法を組み入れるためには以下が必要
1 選択されたデータ源
2 統計学的手法の強みや限界に対する完全な理解
3 データマイニング手法の適用についての十分な技術的専門知識
November 30, 2016 79 / 84

Part2 社内データベースの利用 第二部のまとめ
第二部のまとめ II
①データ原については社内で集めたデータの範囲・保存について十分な理解が必要なことを示してい
る．多くの社員が関与した結晶であり「使えるモノ」と仮定して良かろう．
③手法の適応については，事例にあてはめ，驚くほどマッチしている様を図示した．プログラム作成
者のプログラミング，SQL スキルも十分高いが非専門家に説明困難で省略．作者は RDBM やプログ
ラミング経験が 10 年以上，統計的プログラミング経験が 5 年以上ある．
②についての「限界・強み」を示すには，きちんと数式から導出し根拠を理解する必要がある．数理モ
デルは医薬領域での先行研究や心理・経済・生態学の領域などで，アカデミアですでに理論的に体系
化され保証されているので，理解して活用すればよい．
ここで塩野義として②の「限界： 統計的手法の強みを生かすために集めたデータの限界」について
知っておく必要がある．
P. 10で示したように 91%もの組み合わせは 6/75 回しか観察されていない．最尤推定原理による推定
において「６サンプルサイズ」は絶望的な数字である．推定精度を示す指標をフィッシャー情報量と
呼び，この量が６では少なすぎる．
情報量は同サンプルサイズでは簡単なモデル > 複雑なモデル．その結果，仕組みとしてはゼロ切断モ
デル ZTP がたとえ正しいとしても，情報量の観点からはポアソン分布を用いることが相対的によい
結果を示す可能性が高い．
さまざまなモデルを数理的に示したのは，複雑な事象を説明するモデルには複数のパラメータが必要
となり，ある程度大きな情報量が期待されることを示すため．
数式は「理論値」なので無限に情報量があるときには必ず点で推定されるが，
わが社のもつ推定精度的情報量は少ないため， 「限界」があることを知ることが必要である．
経験上 30 以上の試行があれば複雑なモデルが利用できるが，そういう組み合わせは6000 ∗ 0.5% ≈ 30
とほんのわずかなパターンの有害事象しか検討できないのである．
November 30, 2016 80 / 84

Part2 社内データベースの利用 第二部のまとめ
第二部のまとめ III
①，②の「強み」 ，③はすべて「学習」し「訓練」により習得できるので内的因子といえるが，②の
「限界」は会社でどうすることもできない外的因子といえる．この制限のため，限界を超えた精度情報
を得ることはできない．
一方で，この低い精度情報で意思決定を行わなければならないのが安全性領域のつらさである．
この状況で情報（データ）を補正・補助するために，専門知識や（事前）情報が存在するならば，それ
を数学的・透明に組み合わせ補正ができる．　これがベイズ定理が CIOMS ６で推奨される理由であ
る（だろう） ．6．ベイズ定理の利用については第三部で触れる．
November 30, 2016 81 / 84

Part2 社内データベースの利用 第二部のまとめ
第二部のまとめ IV
シグナル検出について理解を深めつつ，実データあてはめ事例を示した
社内安全性 DB の CW5 内データ約 22 万例，薬剤と PT ベースの有害事象組み合わせ約 6000 組につい
て新提案ルール（ポアソン分布のパラメータを行った．
先行研究に則り，ゼロ修正モデルである ZTP パラメータを具体的にデータに対し算出し， 約 80%が説
明できるだろうことを示した
シグナル検出理解と限界についての序論を紹介した
複雑な事例についての対応は第三部で説明する
各モデルについて，情報量からの限界を示す
複雑な事例である約 20%については，負の二項分布（のベイズ推定）などの複数パラメータモデルや混
合分布を使って推定する
約 80%のモノはいわゆる「個別症例評価」から「集積された情報の評価」に対応する基礎理論だけで
計算した情報が（十分有用で）活用できるだろう．
約 80%はすぐさまこの方法を実戦してよい！ と宣言し，第二部のまとめとする．
November 30, 2016 82 / 84

Part2 社内データベースの利用 第二部のまとめ
第二部 完
第三部は稀なケース対象の混合分布とゼロ過剰等急ぐ場合はまとめへ
November 30, 2016 83 / 84

Part2 社内データベースの利用 第二部のまとめ
参考文献
[1] 岩崎学，阿部貴行（万有製薬）, 正確法と近似法によるカウントデータの解析法
[2] 岩崎学, カウントデータの統計解析(統計ライブラリー)
[3] 岩崎学, 廉 民善, ゼロトランケーションのあるカウントデータの解析,
[4] 岩崎学, 稀な事象の生起確率に関する統計的推測
[5] 岩崎 学, 阿部 貴行(万有)，打ち切りおよびトランケーションの下でのパラメータ推定に及ぼす切
断点の影響評価
[6] 大道寺 香澄（エーザイ安全管理部）, ゼロ修正されたポアソン分布におけるゼロ修正パラメータの
統計的推測
[7] 松原望, ベイズ統計学概説―フィッシャーからベイズへ
[8] 松下泰之, 製薬企業の自発報告データベースに基づく安全性情報検出法の研究
[8] 奥村 晴彦(三重大)，ポアッソン分布
[9] 小宮山　靖, 医薬品評価委員会　データサイエンス部会, 続編，くすりと有害事象の因果関係
[10] 大島康雄, 日本内科学会雑誌, Vol. 100 (2011) No. 8 p. 2323-2333, Evidence-based Medicine
（EBM）有害事象と医薬品の因果関係評価について
[11] 一般化ポアソン分布及びポリアーエゲンベルガー分布の構造化パラメータを用いた誤答数のモデ
ル, 行動計量学19巻 2 号 (通 巻37号)
[12] 渡辺美智子，第III 部 統計計算の展開と統計科学
[13] 金谷 健一(岡大)，これなら分かる最適化数学―基礎原理から計算手法，共立出版
[14] Guillet Hamilton, Quality Measure in Data Mining, P, Springer
November 30, 2016 84 / 84