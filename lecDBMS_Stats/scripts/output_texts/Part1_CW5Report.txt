三例五例ルールの数理的基礎と推定への応用
数理解説と確率モデルによる発生傾向変化予測への応用
山口 学
安全管理部＠検討会効率化 WT5
2015-04-21(Thu)
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 1 / 103

概要
1 現状ルールの謎の解明と改善提案
三例五例ルールとは．本質はなにか？
調査で用いられるPoisson分布の利用
ポアソン分布から新ルール正統性
謎解き
新ルールの創出
第一部のまとめ
2 社内安全性DBへの適用（パラメータ推定）
3 Part2社内データベースの利用
CW5内データ基礎統計値
関係性の指標
ポアソン分布の特徴理解
ポアソン分布で説明困難な事象例
複雑な事象に対応するモデル
ゼロ修正ポアソン分布
パラメータ推定プログラム
ゼロ過剰ポアソンモデルパラメータ推定
第二部のまとめ
4 複雑な事象に対応するモデル適用
過分散に対応するモデル
Gamma Poison = Negative Binomial
Bayes approch
EMによる混合モデルへの対応
Mixture Gamma Poisson:GPS
EBGM
5 性能評価（シミュレーション）
ダミーデータ生成による性能比較
6 まとめ
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 2 / 103

この資料の全体的な構成について
有害事象の検討会開催現行ルール「三例五例」の解説と改善提案
社内安全性 DB の内容・実例紹介とモデルとの比較
パラメータ推定性能シミュレーションと社内 DB の限界
まとめ
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 3 / 103

現状ルールの謎の解明と改善提案 三例五例ルールとは．本質はなにか？
はじめに：三例五例ルール
ある有害事象の「未知重篤事例三例若しくは…五例」が（累積）集積されたら検討すると
いうモノがある．これには下記の疑問が存在し，それらにまず回答する．
なぜ三例という数字が出てきたのか？
一例目，二例目は無視してよいのか？
だとすればそれはなぜか？
一律に三例で良いのか？
使用患者数は AQP の数十人／月から CYM の数千人／月と全く違うが・・・
本当に一律三例を見てゆけばよいか？
長い期間を継続的・累積的に見るべきか？
なぜに？ どこの段階・時期で「三例に二例足して五」か？
何年経過してでも蓄積した結果を評価するのか？
このルールは正しいのか？ このルールが数理的にどう説明できるかを明らかにし，その
数理的保証の元で運用する新ルールの提案を行う．
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 4 / 103

現状ルールの謎の解明と改善提案 三例五例ルールとは．本質はなにか？
Rule of Three bya Binomial DistributionI
コインの裏表など，ある確率 p で発生し，ある確率 1 − p で発生しない事象考える．
一回試行した時，裏か表が必ず出るする．表がでる確率をp(0 ≤ p ≤ 1) とする．またこの
試行を繰り返す期間で p は一定と仮定する．試行結果は表か裏なので，結果を大文字 X
として表示する．
X =
{
1 (表がでたとき． 事象が発生したとき)
0 (裏がでたとき． 事象が発生しなかったとき)
X = 1 となる確率は p と自明であり，X の取りうる値に対してその確率が決まる．このよ
うな X を「確率変数」と呼び「X が表のときの確率」を Pr(X = 0) =p と書く． 「X が発
生しないときの確率」と読む．
この試行を n 回の独立 (i.i.d.) な試行を繰り返して行った時の結果は X1,X2,··· ,Xn と結果
の合計であり，この和 Y = ∑n
i=1 Xi とした値も確率変数になり，
Pr(X = y|p) =Pr(X = x|p,n) =p と表現できる．
Pr(X = x|p,n) =
(n
x
)
px(1 − p)n−x (1)
これを二項分布（Binomial Distribution ）という (1)． 「未知」とは，n 回の独立な試行を
行った時事象が一回も生起しなかったことである．
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 5 / 103

現状ルールの謎の解明と改善提案 三例五例ルールとは．本質はなにか？
Rule of Three bya Binomial DistributionII
すなわちの発生回数 X=0 回だから (2) ．
Pr(X = 0|p = pu,n) =
(n
0
)
p0u(1 − pu)n (2)
= ( 1 − pu)n = α (3)
pu = 1 −α1/n (4)
p の信頼区間の上限 pu を，小さな確率値として後に計算することし α とおく (3)．よっ
て信頼区間の上限の確率 pu は (4) となる．
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 6 / 103

現状ルールの謎の解明と改善提案 三例五例ルールとは．本質はなにか？
Rule of Three bya Binomial DistributionIII
(3) で自然対数を取ると (5)．この式は Taylor展開（べき級数展開）により
Taylor(log(1 − pu)) =−
∞
∑
k=1
(−1)k(−x)k
k = −pu − p2u
2 − p3u
3 − p4u
4 −O(p5
u) ≈ −pu
と再定義できる．
この再定義結果から， pu が 0 に近い場合には級数展開の二次項以後が 0 に極めて近い値
になるので，log(1 − pu) ≈ −pu と近似される (6)．
nlog(1 − pu) = log(α) (5)
n(−pu) = log(α)
pu ≈ − log(α) 1
n (6)
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 7 / 103

現状ルールの謎の解明と改善提案 三例五例ルールとは．本質はなにか？
“別の”試行で pu の時の生起回数期待値
同じ確率 pu で， 別のm 回試行を行った時の生起回数の期待値は， 確率× 試行回数であり，
正確には (7) となるが計算が難しく理解しにくい．そこで近似の (6) から (8) を考える．
正確なE[X|p = pu] = mpu = (1 −α1/n)m (7)
近似のE[X|p = pu] = mpu ≈ −log(α) m
n (8)
ここで対象が医薬品を考えると，一般に先月試行 n と当月試行 m が同じとは限らないが，
概ね売り上げ変化率に比例し，レガシー品を考えれば m
n = c ≈ 1 として問題がない 1．
すると薬剤ごとに異なる試行サイズ m1,m2, . . .に束縛されない値 −log(α) だけ注目すれ
ばよい．
さらに m1,m2, . . .には制限がなくどんな数であっても (8) が成り立つ．
α = 0.05 とすれば，log(0.05) ≈ −2.99573 だから“別の試行”での生起回数期待値
E[X|p = pu] =mpu ≈ 3 となり，これが「三例の正体」である．
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 8 / 103

現状ルールの謎の解明と改善提案 三例五例ルールとは．本質はなにか？
さまざまな試行回数とその期待値
生起確率 100(1 −α)% を片側信頼区間 α = (0.1,0.05,0.025,0.01) の上限 pu とし，試行を
102,3,···,6 回行う時の正確な期待値 (4) と近似の期待値 (6)．
n α
0.1 0.05 0.025 0.01
10 2.05671765 2.58865551 3.08497108 3.69042656
100 2.27627790 2.95130496 3.62166926 4.50074140
1000 2.29993618 2.99124955 3.68208390 4.59458265
10000 2.30232002 2.99528360 3.68819915 4.60410997
100000 2.30255858 2.99568740 3.68881142 4.60506415
1000000 2.30258244 2.99572779 3.68887265 4.60515958
−log(α) 2.30258509 2.99573227 3.68887945 4.60517019
Table: 正確な期待度数と近似の期待度数
医薬品の場合，殆どは投薬が月 100 人以上であり，−log(α) として問題がない．
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 9 / 103

現状ルールの謎の解明と改善提案 調査で用いられる Poisson 分布の利用
市販後調査の制限・限界（ポアソン分布の出番）
過去の定期報告や再審査では別表において販売数から患者数を推定し，これを分母にして
発生件数を割った値を「推定発生確率」とする慣習が薬業に存在する．
[10][大島] によれば，近年この推定方法が規制される方向にあるという．
ヨーロッパの規制当局である EMEA のガイドライン案によると， 「すでに市販
されている医薬品で，自発報告された有害事象数あるいは有害反応数を分子に，
販売数を分母にした報告率は，医薬品使用者での有害反応の発生率の推定値と
して提示すべきではない． 」とあり，少なくともヨーロッパでは好ましくないこ
とと考えられている．
「三例の正体」がわかったが，販売数を分母にするのが問題となれば根拠の二項分布を使
えない．
二項分布は治験のような「試験」において試行回数がわかるものをモデルの対象とした確
率である．この確率計算では n を固定するため，報告上限回数を max(X) ≤ n と制限する
ことに該当する．自発報告は調査なので上限回数を制限することはビジネス的にありえ
ない．
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 10 / 103

現状ルールの謎の解明と改善提案 調査で用いられる Poisson 分布の利用
故にポアソン分布の利用 I
[10][大島] よれば，販売数を仮定した指標は問題をはらむので回避する．
自発は「報告」なので，試行回数がわからない．発想を転換し「時間幅 h = t/n」を仮定
し，この期間内は事象が 2 回以上の時も峻別できるよう n を大きな値にする．
いま, 区間 (0,t) におけるその事象の平均生起数を λ で一定とすれば, np = λ となる. こ
のとき, n → ∞ (すなわち p → 0) とすれば確率は Pr(X = x|λ) と表されるポアソン分布
（Poisson Distribution ）に従う (9)[2, 岩崎]．
Pr(X = x|λ) = λx
x! e−λ (x = 0,1,2,··· ,∞) (9)
二項分布における報告上限の制限が無く，サンプルサイズ n の制限がない (9)．
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 11 / 103

現状ルールの謎の解明と改善提案 調査で用いられる Poisson 分布の利用
故にポアソン分布の利用 II
試験（二項分布）から調査（ポアソン分布）へ
調査も試験と同様にポアソン分布で確率がわかる．
平均の母数 λ において，ある事象 X が x 回発生する確率は (9) で計算できる．
新垣結衣が山口に週平均 5 回メールをくれる．今週「０」回の確率は (10)．
Pr(X = 0|λ = 5) = 50
0! e−5 = d pois(0,5) ≈ 0.06 (10)
広瀬すずが山口に週平均 10 回メールをくれる．今週「０」回の確率は (11)．
Pr(X = 0|λ = 10) = 100
0! e−10 = d pois(0,10) ≈ 0.000 (11)
結衣が p ≥ 0.05 ですずが p ≤ 0.052．
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 12 / 103

現状ルールの謎の解明と改善提案 ポアソン分布から新ルール正統性
Rule of Three bya Poisson Distribution
ポアソン分布は「生起確率は小さいが試行回数が大きいために何回か生起が観測される稀
な事象」の分布として有害事象の他，原子崩壊，出生率，交通事故などを予測する目的で
物理・生態学・疫学等で広く用いられる．
ここで「3 例」ルールを同様に確認すると 3，未知とは (9) の時の X = 0 の確率である．
この時，λ の 100(1 −α)% の上片側信頼区間の上限を λu とすると (12)．
Pr(X = 0|λ = λu) = λ0
u
0! e−λu (12)
e−λu = α (13)
λu = −log(α) (14)
(13) は自然対数を取れば (14) これは P. 5 の結果と同様 −log(α) となった．
α = 5% と設定した時は同様に −log(0.05) =2.99573 ≈ 3 例となる．
かように調査においても「3 例」ルールは成立する．
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 13 / 103

現状ルールの謎の解明と改善提案 ポアソン分布から新ルール正統性
数理的にわかること・その理解
数理的にわかること＃ 1
ある事象の生起確率が具体的にわからなくても， 「未知の事象」の場合には，100(1 −α)%
片側信頼区間の上限 α だけで決まり，試行回数 n が千回，万回だろうが期待度数は
−log(α) 回となる．
片側 95%信頼区間とすると，−log(α = 0.05) ≈ 3 であり，生起回数期待値がおよそ 3 回
までは発生確率が同じとみなせる．
数理的にわかること＃２
未知事象 3 例に着目している場合，生起回数 X=0 の時の確率の上限が 100(1 −α)% を超
えていないことを確認している．
逆に言えば，別の期間に 3 を超えた事を確認した場合，これは直接確率検定において「発
生確率は有意に差がある」ことに該当する．
数理的にわかること＃３
分かりにくいが，いわゆる「未知」の事象，X=0 を仮定した時でも 3 例までは 95%の確
率で発生しうる．逆に言えば，各調査期間で 3 例以下は「未知」として見なしてもよい．
しかし，それを超えて 4 例確認された場合，珍しい 5%以下の事例であるから，ふつーの
有意水準での「統計的に差異がある」に該当する．
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 14 / 103

現状ルールの謎の解明と改善提案 謎解き
未知三例の謎解きと新ルール設定
なぜ三例という数字が出てきたのか？
一例目，二例目は無視してよいのか？
だとすればそれはなぜか？
医薬品の文脈で， 「ある医薬品をn 人に投薬し，未知（X=0）であると仮定した時であっ
ても，95%信頼区間の確率 p = pu を仮定したとき，同様の人数に投薬したら 3 例（X=3）
の発生がありうる」のである (8)．
「未知の事象」 であっても，次の単位期間に 3 例以下の発生が 95%の確率で確認され得る．
すなわち，このリスクまでを許容する場合，3 例まで無変化とみなし，4 例目が確認され
た時点で 5%の珍しい事象であり， 「未知の事象」として仮定した確率pu が同じではない
と判断する．許容範囲を超えたリスクに対して対処する．という流れになる．これは
Fisher 流の有意性検定 (signiﬁcance test) の枠組みを逐次行う事に該当する．
確率論的意思決定で α = 5% を採用する場合は「未知 4 例で対応を考える」のが一般的で
ある．このように不確実性の元での意思決定を「統計的決定」という [7, 松原]．
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 15 / 103

現状ルールの謎の解明と改善提案 謎解き
どの品目でも成り立つか？
一律三例で良いのか？
使用患者数は AQP の数十人／月から CYM の数千人／月と全く違うが・・・
本当に一律三例を見てゆけばよいか？
pu は m,n に束縛されるので各品目で普通は異なる．しかしどんな m,n でも， (8) の期待
値の「3 例」ルールは成り立つのである．
α = 5% と設定した時，一律 −log(0.05) ≈ 2.99573 = 3 例に着目すればよい．品目ごとに
m,n に差異がある場合でもｃ倍の係数がわかればよい．ポアソン分布により，期間を定め
て比較すれば m,n も関係がない．
3 例まではセーフとして単純に期間毎にカウント結果を見れば良い 4．
このルールは意味を一般社員が認識しやすく，便利である．未知以外にも P.5 で示した
式 (1) の X 回に未知以外の数 1,2,··· ,n をそれぞれを入れれば，各生起回ごとに95%を超
える回数を決めることができる．一般に有害事象の件数は少なく，x ≤ 10 程度をあらかじ
め計算しておけば誰でも即時に用いられる．またデータベースから機械的に引けて便利で
ある．
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 16 / 103

現状ルールの謎の解明と改善提案 新ルールの創出
基本的意思決定の礎（二項分布）
稀事象に対する生起確率の許容リスク
n 人調べて 0 例観察された時，別の n 人中に 03 例が観察の可能性がある
n 人調べて 1 例観察された時，別の n 人中に 05 例が観察の可能性がある
n 人調べて 2 例観察された時，別の n 人中に 07 例が観察の可能性がある
n 人調べて 3 例観察された時，別の n 人中に 08 例が観察の可能性がある
n 人調べて X 例観察された時，別の n 人中に XX 例が観察の可能性がある
稀事象に対する生起確率の対応ルール
事前に n 人調べて 0 例観察されている時，別の n 人中 04 例以上は傾向変化の兆し
事前に n 人調べて 1 例観察されている時，別の n 人中 06 例以上は傾向変化の兆し
事前に n 人調べて 2 例観察されている時，別の n 人中 08 例以上は傾向変化の兆し
事前に n 人調べて 3 例観察されている時，別の n 人中 10 例以上は傾向変化の兆し
事前に n 人調べて X 例観察されている時，別の n 人中 XX 例以上は傾向変化の兆し
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 17 / 103

現状ルールの謎の解明と改善提案 新ルールの創出
基本的意思決定の礎（ポアソン分布）
稀事象に対する生起確率の許容リスク
平均で 0 例観察された時，別のある単位期間内に 03 例が観察の可能性がある
平均で 1 例観察された時，別のある単位期間内に 05 例が観察の可能性がある
平均で 2 例観察された時，別のある単位期間内に 07 例が観察の可能性がある
平均で 3 例観察された時，別のある単位期間内に 08 例が観察の可能性がある
平均で 4 例観察された時，別のある単位期間内に 10 例が観察の可能性がある
平均で 5 例観察された時，別のある単位期間内に 11 例が観察の可能性がある
稀事象に対する生起確率の対応ルール
平均で 0 例観察されている時，別ある単位期間内で 04 例以上は傾向変化の兆し
平均で 1 例観察されている時，別ある単位期間内で 06 例以上は傾向変化の兆し
平均で 2 例観察されている時，別ある単位期間内で 08 例以上は傾向変化の兆し
平均で 3 例観察されている時，別ある単位期間内で 10 例以上は傾向変化の兆し
平均で 4 例観察されている時，別ある単位期間内で 11 例以上は傾向変化の兆し
平均で 5 例観察されている時，別ある単位期間内で 12 例以上は傾向変化の兆し
発生確率を求めるではなく，期待値から考察すると難しい問題がシンプルになってよい．
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 18 / 103

現状ルールの謎の解明と改善提案 新ルールの創出
非重篤例たして五？
長い期間を継続的・累積的に見るべきか？
なぜに？ どこの段階・時期で「三例に二例足して五」か？
何年経過してでも蓄積した結果を評価するのか？
Y を「ポアソン分布の和 X1 + X2 の分布」と考える．
ポアソン分布の和のモーメント母関数はそれぞれのモーメント母関数の積になる．モーメ
ント母関数自体は Mx(t) =e[λ(et −1)] であるから MY (t) は Mx1 (t)Mx2 (t) となり (15) より Y
は Poisson(λ1 + λ2) となる．これをポアソン分布の再現性定理という．
MY (t) = e
[
λ1(et −1)
]
e
[
λ2(et −1)
]
= e
[
(λ1+λ2)(et −1)
]
(15)
各々の平均パラメータを足したパラメータが 100(1 −α) を超えたか否かを「ある期間」
単位で比較することは，数理的に保証される．
この「和」はどんな場合でも成り立つので，PT ごとにパラメータを得ていれば，くく
り・取扱いが不完全な DB であっても数理的には合計という行為に問題ない．
現行ルールの「和」は良いが， 「期間」に応対する考慮がなされていない事は問題．
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 19 / 103

現状ルールの謎の解明と改善提案 第一部のまとめ
第一部の提案 I
現状の三例五例ルールの「三」には意味がある．しかし，累積に着目している限り無駄な
検討を行うことになり，効率的に正しくない．
なぜならば，試行累積で見ることは，発生期待値に注目するにすぎないから．
期待値は確率の基本定理により確率×単位期間や確率×試行回数の積で自動的に決まる．
単位期間を無視し， 単に累積で見ることは， 傾向が変化したか否かを問わないことになる．
ある事象の発生確率を考える．その傾向変化がなく・傾向の上昇が認められなければ追加
対策は不要であるはずだ．この変化が認められない場合であっても，生起自体はある確率
で発生し，これを起点に検討を行うことになる．感覚的「またこれか」という意見の正体
である．
つまり累積のみに着目して検討を行うことは，傾向が変化し確率上昇を数理的に確認でき
ない事情がある時 には分析不要で自動的な開催のトリガーになるという利点がある一方
で，確率上昇の有無を確認しないが故に，常に開催しなければならないことになる．
さらに，発生頻度が「未知」では無い場合は期待値を無視しているので評価すべきでない
時期で検討するという場合が起こり得る．
すると薬事法施工規則第二百二十八条の二十（副作用等報告）でいう「・・・発生頻度，
発生状況・・・」の変化を見るべき検討が，無駄な時にも実施されることになる．
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 20 / 103

現状ルールの謎の解明と改善提案 第一部のまとめ
第一部の提案 II
社内 RDBM 内のデータ活用プロセスとして，アクセス・エクセルを用いた各種一覧表が
作成され利用されている．それら帳票で見ることは，客観的で網羅性がある．薬事法施工
規則第四十三条・第六十一条等における「・・・の信頼性の基準」は 3 項目から成り，
「・・・目的としたデータ以外使用禁止」 ， 「網羅性」 ， 「 （査察・再現目的の）記録の保存」
が規定されているからだろう．
現在の部内データベース活用は，信頼性保証本部の鑑・ 「網羅性」担保を管理目的とした
ものと推察され品質管理的な工程管理目的の情報活用とみなせる．
この活用プロセスのアウトプットは「開催」であり，その後は「個票確認」を主体として
分析・評価が行われ対策等立案が行われているとみなせる．
品質管理のトリガーとして累積情報を用いるが，分析目的・科学的な活用はされず大変
もったいない．数学を利用すれば開催時期はコントロールして効率化できる．活用法の説
明等は具体的に第二部で示す．
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 21 / 103

現状ルールの謎の解明と改善提案 第一部のまとめ
これまで
Programing Database
計算機科学 Data Science
科学的な安全対策
経験科学
→ → 
理論科学
← ← 
S.O.P Statistics
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 22 / 103

現状ルールの謎の解明と改善提案 第一部のまとめ
これから
Programing Database
計算機科学
↘ → 
Data Science
← ↙ 
科学的な安全対策
経験科学
→ → 
理論科学← ← 
↖ ← 
S.O.P Statistics
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 23 / 103

現状ルールの謎の解明と改善提案 第一部のまとめ
第二部で示す提案趣旨
第二部では， 「個票確認」とは異なる視点で，蓄積データの分析を行う．報告が発生する
仕組みを表現した統計的モデルを用いてパラメータを得る．これを評価し，得られる各種
情報（報告率，推移など）を基に開催トリガーに用いたり，検討会開催時の判断支援に対
応できるだろう情報事例を提示する．
WT が提案すべき「検討会の効率化」には，個票をシコシコ見る以外にもあらたに活用す
べきモノがあることを示すことも必要である．データベースから得られる情報・シグナル
事例を第二部で示す．
これによって開催トリガーに用いたり，判断トリガーとして使える材料を提示できるかも
しれない．
その効果が納得できれば，検討会の運用タスク効率や分析タスク効率の軽減に貢献するか
もしれない．そういったものに期待と興味がわけば，大変マニアックな第二部をお読みい
ただきたい．不足点があれば，追加分析していきたいと考えている．
A highly controversial proposal な話題が第一部の締めくくりである．
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 24 / 103

Part2 社内データベースの利用
Part2 社内データベースの利用
社内データベース CW5 内情報分析事例について
確率モデルを応用した各種発生傾向の把握
安全管理部＠検討会効率化 WT5
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 25 / 103

Part2 社内データベースの利用
説明概略
Programing Database
計算機科学
↘ → 
Data Science
← ↙ 
科学的な安全対策
経験科学
→ → 
理論科学← ← 
↖ ← 
S.O.P Statistics
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 26 / 103

Part2 社内データベースの利用 CW5 内データ基礎統計値
全収集情状況
出力日(Fri Jul 31 10:56:54 2015 )
情報源 CNT PCT
1 自発報告 100840 38.18
2 CIOMS （過去データ） 74734 28.30
3 文献・学会 35286 13.36
4 使用成績調査 13745 5.20
5 その他 12992 4.92
6 臨床試験（治験） 11758 4.45
7 特定使用成績調査 9572 3.62
8 臨床試験（製造販売後） 2264 0.86
9 厚生労働省 1313 0.50
10 救済基金 1065 0.40
11 感染症定期報告用文献・学会 330 0.12
12 規制情報 164 0.06
13 臨床試験（医師） 57 0.02
14 0 0.00
Table:情報源の一覧とその割合
CW5ADRには，管理番号単位で206520件のレコードが保存されている．
情報源で多いのは，自発報告(100840，38.18%)，CIOMS（過去データ）(74734，28.3%)，文献・学会 (35286，13.36%) だった．
情報媒体区分で多いのは，CIOMS Form(150673例,62.73%)，CIOMS Form(治験)(30478 例,12.69%)，有害事象緊急連絡票(12869 例,5.36%) だった．
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 27 / 103

Part2 社内データベースの利用 CW5 内データ基礎統計値
情報媒体区分
情報媒体区分 CNT PCT1 CIOMS Form 150673 62.732 CIOMS Form(治験) 30478 12.693 有害事象緊急連絡票 12869 5.364 使用成績調査票 6714 2.805 文献・学会 6487 2.706 特定使用成績調査票 5357 2.237 副作用・感染症調査票 5006 2.088 その他 4748 1.989 特別調査調査票 3218 1.3410 有害事象調査票 3178 1.3211 副作用・感染症緊急連絡票2735 1.1412 中途終了書 1698 0.7113 調査要件確認連絡票(国内文献MR返信用) 1563 0.6514 対応記録 1228 0.5115 救済基金 1084 0.4516 医薬品安全性情報報告書(結果回答書) 579 0.2417 医薬品安全性情報報告書 508 0.2118 製造販売後臨床試験症例報告書454 0.1919 症例個票 449 0.1920 市販後臨床試験症例報告書 197 0.0821 重篤な有害事象に関する報告書187 0.0822 安全性情報詳細調査票 161 0.0723 安全性情報の変更・追加報告書147 0.0624 臨床試験症例報告書 142 0.0625 Data Clariﬁcation Form 123 0.0526 規制情報 98 0.0427 妊娠症例追跡調査票(出産時) 33 0.0128 医療機関報告詳細調査結果 28 0.0129 安全性情報の調査依頼書・回答書15 0.0130 妊娠症例追跡調査票(妊娠確認時) 13 0.0131 重篤有害事象自発報告共通連絡票9 0.0032 胎児における有害事象調査票1 0.0033 0 0.00
Table:情報媒体区分一覧とその割合
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 28 / 103

Part2 社内データベースの利用 CW5 内データ基礎統計値
集計対象
WT の取り決めにより全データから下記条件に適合する 24895 件 75 か月分をデータセッ
トとして本検討に用いることとした．期間をこれに定めた理由として，１）DB システム
変遷や２）E2B/M2 の ICSR 項目が R2 から R3 に変わったことが蓄積期間内で発生し，
同じ条件でデータが保存されていないとの事で設定した 5．
情報源
使用成績調査，厚生労働省，救済基金，特定使用成績調査，自発報告
第一報情報入手日 = BETWEEN ’20090101’ AND ’20150331’
国内 区分 = ’ 国内’
情報媒体区分 <> ’CIOMS Form’
その他の条件
上記のように設定してある 6．
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 29 / 103

Part2 社内データベースの利用 CW5 内データ基礎統計値
対象データのサマリー
YEARMON CODE PT YOBS ICSRS MONTH DENS PERDB
1 2014 01: 398 CYM :3668 悪心 : 403 Min. : 1.0 Min. : 1 Min. : 1.0
2 2013 11: 329 PRS :2144 肝機能異常: 386 1st Qu.: 1.0 1st Qu.: 8 1st Qu.: 2.0
3 2012 03: 322 IRB :1019 発疹 : 370 Median : 1.0 Median : 22 Median : 6.0
4 2012 02: 302 OXC : 975 薬疹 : 321 Mean : 1.5 Mean : 50 Mean :12.7
5 2015 02: 302 RAC : 912 肝障害 : 291 3rd Qu.: 1.0 3rd Qu.: 83 3rd Qu.:18.0
6 2013 03: 293 PT : 904 下痢 : 272 Max. :60.0 Max. :326 Max. :64.0
7 (Other):15154 (Other):7478 (Other) :15057
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 30 / 103

Part2 社内データベースの利用 CW5 内データ基礎統計値
月の報告受領数
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 31 / 103

Part2 社内データベースの利用 CW5 内データ基礎統計値
サマリー解説
PT 単位で，月におよそ３００件のデータが発生し，もっとも多い薬剤は
CYM,PRS，IRB
PRS は直後調査時に多量に報告されたことが影響？
PT は 1397 種類で悪心．肝機能異常など一般的なモノが最も多い
BETA，BETA0 は後に行うパラメータ推定に用いる十分統計量の各種「合計」
DENS PERDB は後に信頼性区間や情報量 I(θ) として用いる
集合論での濃度．この DB では 75 か月
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 32 / 103

Part2 社内データベースの利用 CW5 内データ基礎統計値
情報量基準で見れば粗密データベース
この DB 中の PT の種類は 1397 で，薬剤の数は 162 だから PT 行 X 薬剤列の表は
セル数 226314 になる
全部のセルに情報が存在することを期待したいが，対象 DB の中には 6040 （約
2.67%）しかセルが存在しない．
巨大な表にまばらにしか情報が存在しない場合，分析が困難で保存効率も悪い．
経時変化を見るために，さらに時間次元を加えて 3 次元とすると 17100 ÷ 16973550 ＝
0.1%となって情報量基準で DB を評価した場合には，極めて疎な DB であるといえる．
ICSR レコード数は多くとも，薬剤ｘ事象の組み合わせ情報は得られていない状況である．
情報理論によれば，精度はモデル毎に定まる情報量（Fisher Information ）に反比例するた
め疎な DB では統計理論上の推定精度が低下する．これら情報量の低さや，モデル選択の
困難が安全性情報を科学的に分析することを困難にする原因の一つとなっている．
一般に複雑なモデルでは Parameter 数が多いので一データあたりの情報量は減少する事
が課題になる．それらを改善する目的でベイズ的に事前情報をうまく用いていて分析する
ことが必要になる．
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 33 / 103

Part2 社内データベースの利用 CW5 内データ基礎統計値
濃度全容：91.35%は 75 カ月中, ６回未満
(0,6] (6,12] (12,24] (24,36] (36,48] (48,75]
Ç»ÅÙ½¸·×ËÀ¥°¥é¥Õ
´ü´Ö¡Ê·î¡Ë
(%)
0.0 0.2 0.4 0.6 0.8
   (0,6] (92.06%)
  (6,12] (4.57%)
 (12,24] (2.27%)
 (24,36] (0.57%)
 (36,48] (0.30%)
 (48,75] (0.24%)
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 34 / 103

Part2 社内データベースの利用 CW5 内データ基礎統計値
予備知識： 「情報」とは
「情報」という用語は日常使われるにもかかわらず，難解な概念である．21 世紀において
は３つの大きな定義があり，文脈で理解が必要．
Data Volume
一件二件，一枚二枚，K Byte, M Byte などの物理量的な量
Uncertenty
母数推定における精度を示す量 I(θ)
ガウス曲率から発展し，19 世紀に定義されたフィッシャーの情報量
unexpectedness
情報伝達の不確実性を示す量エントロピー I(E)
熱力学から発展し，20 世紀に定義されたシャノンの情報量
推定における精度・確からしさを示す量についてシミュレーションで示す．
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 35 / 103

Part2 社内データベースの利用 CW5 内データ基礎統計値
λ = 2 推定の精度（標準誤差 S.E）と情報量
●
●●
●
●
●●●
●
●
●●
●
●
●●
●
●
● ●
●
●
times6 times120 times600 times1.2k
1 2 3 4
1000²ó¥·¥ß¥å¥ì¡¼¥·¥ç¥ó)
lambda¿äÄêÃÍ
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 36 / 103

Part2 社内データベースの利用 CW5 内データ基礎統計値
社内安全性 DB の情報量的限界
P.34 のグラフにより，多くの薬剤×有害事象の場合，統計的には「6 サンプルで母数推定
を行う」ことがわかる．この状況では情報量が乏しく推定誤差が大きい．
シミュレーションで 120 サンプルで改善されているが，これは 10 年間蓄積した時に該当
する．10 年間も態度を保留することは，ビジネス的にあり得ない．我々は，たかだか過去
4,5 年のデータで今月・今季のことが知りたいのである．
情報が乏しい状況で判断が必要なので，第一部で紹介した「新３例ルール」を各期ごとに
見つづけることがこの低い情報量の現状を補うかもしれない．ある期間毎に 4 例以上の発
生があったかを見るだけで異常検知になる 7．
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 37 / 103

Part2 社内データベースの利用 関係性の指標
関係性の指標について
関係性を見るための指標総論
ある事象とある事象の関係性を調べる指標は幾つも存在し，それぞれ特徴がある．
薬剤と有害事象の関係など，カテゴリカルデータの関係分析を一般にアソシエー
ション分析という
φ 係数, コンテンジェンシー（クラマーの V，ピアソンの C）など
錠剤重量と含量の関係など，連続データの関係分析を一般に相関分析という
ピアソンの積率相関係数，順位相関係数（スピアマンの ρ，ケンドールの τ）など
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 38 / 103

Part2 社内データベースの利用 関係性の指標
薬剤と有害事象の関係性その指標 I
ある事象とある事象の関係性を 2X2 の表で調べる場合も指標は幾つか存在る．2X2 の表
で調べるカテゴリカルデータの分析を一般にアソシエーション分析という．
この関係性指標は確率的な観点から区別される．
Reporting Ratios (RR) ：薬剤報告率の観点
RR = Pr(AE|Drug)
Pr(AE) = Pr(AE,Drug)
Pr(AE)Pr(Drug)
Proportional Reporting Ratios （PRR） ：相対リスクの観点
PRR = Pr(AE|Drug)
Pr(AE|¬Drug)
Reporting Odds Ratio （ROR） ：オッズ比の観点
ROR = Pr(AE|Drug)Pr(¬AE|¬Drug)
Pr(¬AE|Drug)Pr(AE|¬Drug)
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 39 / 103

Part2 社内データベースの利用 関係性の指標
薬剤と有害事象の関係性その指標 II
RR，PRR，ROR の何を使えばよいのか？
「何を見たいのか？」により異なる．各指標の確率的定義から特性を理解して用いる．行
政が ROR，PRR を用いるのは「ある薬剤と他の薬剤」の関係を見たいからといえる．
また，疫学的なリスク比，オッズ比と定義が同じでなじみ深いこともあろう．
我々は何を見たいのだろうか？
一般に知りたいのは，ある有害事の象発生について， （見かけの）因果関係が，ある薬剤
に認められるか否かであろう．すると，自然に答えが得られる．
RR は有害事象の発生確率 Pr(AE) を分母に，薬剤投与条件下での発生確率 Pr(AE|Drug)
を分子にした比であるから１以上は多いといえる．
すなわち企業は RR で薬剤の（見かけの）因果関係を確認し，つづいて他剤比較に PRR
を見るのがよい．無論行政と同様なモノの見方も必要であろうが．
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 40 / 103

Part2 社内データベースの利用 関係性の指標
薬剤と有害事象の関係性その指標 III
どれか一つの指標い絞ってよいか？
ヒトは 3 次元の住人であり，2 次元以上の関係を認知するのが苦手である．1995-2002 年
に機械学習（組み合わせ最適化）領域の研究により， 「一つの指標で全てに合うモノはな
い」ことが証明されており（Ho and Pepyne ） ，これをノーフリーランチ定理（ノーフリー
ランチていり、no-free-lunch theorem 、NFLT）という．
「あらゆる問題で性能の良い汎用最適化戦略は理論上不可能であり、
ある戦略が他の戦略より性能がよい のは、現に解こうとしている
特定の問題に対して特殊化（専門化）されている場合のみである」ことがわかっている．
現代は複数の指標を用いて判断することが主流になり，これらの研究成果からアンサンブ
ル学習，弱学習が機械学習で生まれた．
安全管理部ニーズのすべてに合致させられる単一指標は存在しない．複数指標の組み合
わせで解決する事が必要である．
There ain’t no such thing as a free lunch.
Robert Anson Heinlein(1907 - 1988)
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 41 / 103

Part2 社内データベースの利用 関係性の指標
薬剤と有害事象の関係性その指標 IV
行政が用いるシグナル検出値が一番よいか？
PRR，ROR は PMDA，MHRA（England） ，Lareb（Dutch）などが使用している．其々に
幾つか制限があり，１）薬剤・有害事象同時頻度≥ 3or4，２）χ2 統計量 ≥ 3.84 などが満
たされる必要がある（PMDA 報告書@三菱総研，キッセイ DS 部会）しかし，[8, DSP ・
松下] はシミュレーション結果から感度が低く企業には向かないと報告している．よって
企業にとってベストではない．
企業はどんなシグナル検出値が一番よいか？
RR は FDA,WHO が用いる指標の基本となる指標であり，これは「薬剤の投与条件下の有
害事象」と「有害事象一般」の関係性指標である． 「 （みかけの）確率的因果関係」とも言
われる．経済や心理学，機械学習の領域一般に用いられ，では LIFT 値 と言われる．
企業にとって，有害事象と薬剤の関係をシンプルに比較できるのでよい．
ちなみに，WHO は RR の各々を混合二項分布，FDA は混合ポアソン分布としたベイズ流
の条件確率である．WHO は Information comportment IC = log2 RR と定義した量を用い
ている．FDA は Empirical Bayes Geometric Mean という混合分布の小さい λ の 5%分位
点と定義した量を用いている．
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 42 / 103

Part2 社内データベースの利用 関係性の指標
薬剤と有害事象の関係性その指標 V
医学・疫学統計領域では RR はリスク比 (Risk Ratio) と誤解されやすいので，LIFT 値 8
と表現する.
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 43 / 103

Part2 社内データベースの利用 関係性の指標
薬剤と有害事象の関係性その指標 VI
PT CODE ALPHA DENSITY RR PRR ZTP λ λ
1 スティーブンス・ジョンソン症候群 PLG A 25 20 15.27 21.03 0.46 0.33
2 スティーブンス・ジョンソン症候群 FMX A 16 16 5.57 6.60 0.03 0.21
3 スティーブンス・ジョンソン症候群 BKT-TA B 11 8 4.20 4.66 0.67 0.15
4 スティーブンス・ジョンソン症候群 VCM J 5 4 7.63 8.03 0.46 0.07
5 スティーブンス・ジョンソン症候群 VE G 4 4 5.17 5.37 0.03 0.05
6 スティーブンス・ジョンソン症候群 P T 4 2 1.09 1.09 1.59 0.05
7 スティーブンス・ジョンソン症候群 VCM P 3 2 39.89 41.27 0.87 0.04
8 スティーブンス・ジョンソン症候群 FM N 3 3 4.90 5.04 0.03 0.04
9 スティーブンス・ジョンソン症候群 CY M 3 3 0.13 0.10 0.03 0.04
10 スティーブンス・ジョンソン症候群 FMX C 2 2 5.88 5.99 0.03 0.03
11 スティーブンス・ジョンソン症候群 KR C 1 1 93.07 94.14 0.03 0.01
12 スティーブンス・ジョンソン症候群 PLG-IN T 1 1 55.84 56.48 0.03 0.01
13 スティーブンス・ジョンソン症候群 RD J 1 1 55.84 56.48 0.03 0.01
14 スティーブンス・ジョンソン症候群 MD S 1 1 25.38 25.66 0.03 0.01
15 スティーブンス・ジョンソン症候群 SG S 1 1 4.73 4.78 0.03 0.01
16 スティーブンス・ジョンソン症候群 N S 1 1 4.11 4.14 0.03 0.01
17 スティーブンス・ジョンソン症候群 BKT-GR A 1 1 2.49 2.51 0.03 0.01
18 スティーブンス・ジョンソン症候群 MD T 1 1 1.68 1.69 0.03 0.01
19 スティーブンス・ジョンソン症候群 EX J 1 1 1.18 1.18 0.03 0.01
20 スティーブンス・ジョンソン症候群 FB X 1 1 0.26 0.25 0.03 0.01
21 スティーブンス・ジョンソン症候群 RA C 1 1 0.19 0.18 0.03 0.01
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 44 / 103

Part2 社内データベースの利用 関係性の指標
薬剤の重篤性関係指標
シグナル検出値は一般的に薬剤×有害事象発生数を比較するモノと認識されている．事前
確率がある薬剤により変化した数量・重篤性・因果関係などを調べる指標としても各種の
定義できる．
これは 事前確率 と 薬剤の条件付き確率 を各指標を基準に比べる事に該当する．いろい
ろな角度で「みかけの因果関係」を調べることができる．
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 45 / 103

Part2 社内データベースの利用 関係性の指標
重篤性関係事例
肝障害に対して FBX の（見かけ上の）因果関係は 1.37 倍
この DB 中には腎障害全数 31 件中，17 例が重篤とされており，肝障害の重篤率は一般に
Pr(AE重篤) =17 ÷31 ≈ 0.548 だった．
FBX という薬剤条件下のそれは Pr(AE重篤|FBX ) =3 ÷4 = 0.75 であり，率比が
0.75/0.548 ≈ 1.37 だから， 「肝障害に対してFBX の（見かけ上の）因果関係は 1.37 倍」
となる．
CODE PT 薬剤重篤数 薬剤数 重篤数 有害事象全数
1 BKT-TAB 腎障害 3 7 17 31
2 CYM 腎障害 2 2 17 31
3 EX-ADU 腎障害 1 1 17 31
4 FBX 腎障害 3 4 17 31
重篤性のみならず，因果関係等についても薬剤×有害事象組み合わせ（全数数 6040 組）についてあ
らかじめ全て用意することにより，対意思決定支援となるはずである．
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 46 / 103

Part2 社内データベースの利用 関係性の指標
最終データとその保管
マーケット領域の ABC 分析，RFM 分析の味付けをして最終資料とする． （最終的には頻
度パラメータも含めて完成させ，WT5 のフォルダーに保存する）
CODE PT First Recent DENS LIFT 重篤 LIFT 因果 未知 既知
1 ALT 光線過敏性反応 2014 09 2014 09 1 0.00 1.08 1 0
2 ALT 接触性皮膚炎 2009 06 2014 12 10 0.93 1.38 0 10
3 ALT 皮膚刺激 2010 01 2011 04 2 1.25 1.00 0 4
4 ALT 皮膚色素脱失 2014 06 2014 06 1 2.00 1.00 0 2
5 AQP Ｃ－反応性蛋白増加 2011 11 2011 11 1 0.00 0.00 1 0
6 AQP そう痒症 2011 08 2014 09 2 0.00 1.20 0 2
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 47 / 103

Part2 社内データベースの利用 ポアソン分布の特徴理解
パラメータ推定とその利用について
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 48 / 103

Part2 社内データベースの利用 ポアソン分布の特徴理解
再紹介 Poisson 分布の特徴
発生頻度やその変化を把握して，傾向変化を捉えて評価を行い，安全対策を作戦するの
が，安全管理のミッションといえる．
調査において基本的な分布モデルは Poisson 分布であることを紹介した．このモデルの性
質を理解し適切に活用する必要がある．
闇雲にデータをモデルに当てはめても意味がなく，モデルの選択自体が正しいこと確認す
ることが重要となる．厳密には難しいが．
モデルのパラメータが求まれば，リスクについてそのパラメータから定量的・客観的に判
断できる．
薬剤×有害事象組み合わせについて情報理論（最尤法）又は，数値演算（反復法・EM
Algorithm）でパラメータを求める．
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 49 / 103

Part2 社内データベースの利用 ポアソン分布の特徴理解
Poisson 分布の期待値
Poisson 分布の期待値・分散を確認する．
Poisson 分布のパラメータは一般に λ と記載される．この時に X 回の事象が発生する確
率，期待値は下記に従う．Poisson 分布の場合，対象データの平均と分散が等しいことが
要求される．
Pr(X = x|λ) =λx
x! e−λ (x = 0,1,2,··· ,∞)
E[X] =
∞
∑
x=0
x λx
x! e−λ =
∞
∑
x=1
x λx
x! e−λ
= λ ×
∞
∑
x=1
λx−1
(x −1)! e−λ = λ ×
∞
∑
y=0
λy
y! e−λ
= λ
分散はやや複雑で天下りに同 λ となる 9．
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 50 / 103

Part2 社内データベースの利用 ポアソン分布の特徴理解
Poisson 分布の使い方 1
発生確率見積もり
ある薬剤×有害事象の組み合わせは 75 か月間で見て月平均 2.4 件報告だった．この時，
ある月に 6 件報告を受けた．
この 6 件報告の確率はいくらか？
Pr(X = x|λ) = λx
x! e−λ (16)
Pr(X = 6|λ = 2.4) = 2.46
6! e−2.4 ≈ 0.024
(16) に代入し，確率は ≈ 2.4%．
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 51 / 103

Part2 社内データベースの利用 ポアソン分布の特徴理解
Pr(X = 0,1,··· ,10|λ = 2.4) の確率
0 2 4 6 8 10
0.00 0.05 0.10 0.15 0.20 0.25
À¸µ¯¿ô
%
●
●
●
●
●
●
●
●
● ● ●
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 52 / 103

Part2 社内データベースの利用 ポアソン分布の特徴理解
Poisson 分布の使い方２
発生異常の見積もり
ある薬剤のある有害事象の報告は，75 か月間を見ると月平均 2.4 件の報告だった．この
情報の元，ある翌月 6 件の報告を得た．この 6 件を異常とすべきか？
∞
∑
i≥6
Pr(xi|λ = 2.4) = 1 −
5
∑
i=0
2.4xi
xi! e−2.4 (17)
≈ 0.036
最初に「異常」を定義する．月平均 2.4 件の元，有意水準 (100 −α) =0.05 として片側
5%を超える確率の場合，異常とみなす a．
「6 件」以上発生する確率は，6,7,··· ,∞ と計算が困難だが確率公理より，１から「余事
象」を引けば良い．
(17) から， p ≤ 0.05 となり定義から「異常とすべき」となる．
a直接確率の検定を行ったことに該当
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 53 / 103

Part2 社内データベースの利用 ポアソン分布の特徴理解
Pr(X = 0,1,··· ,10|λ = 2.4) の累積確率
0 2 4 6 8 10
0.2 0.4 0.6 0.8 1.0
ÎßÀÑ³ÎÎ¨¡Êlambda=Ê¿¶Ñ2.4²ó¡Ë
À¸µ¯¿ô
%
●
●
●
●
●
●
● ● ● ● ●
95%
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 54 / 103

Part2 社内データベースの利用 ポアソン分布の特徴理解
社内 DB の分散対平均のグラフ
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 55 / 103

Part2 社内データベースの利用 ポアソン分布の特徴理解
単純に Poisson 分布が使える事例＃１
Poisson Goodfit test (PRS-ÆÃÈ¯À­ÇÙÀþ°Ý¾É mean:0.55)
0
1
2
3
4
5
6
0 1 2 3
Number of Occurrences
sqrt(Frequency)
●
●
●
●
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 56 / 103

Part2 社内データベースの利用 ポアソン分布の特徴理解
単純に Poisson 分布が使える事例＃２
Poisson Goodfit test (FMXA-È¯¿¾ mean:0.64)
0
1
2
3
4
5
6
0 1 2 3
Number of Occurrences
sqrt(Frequency)
●
●
●
●
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 57 / 103

Part2 社内データベースの利用 ポアソン分布の特徴理解
CW5 内データの分散／平均比グラフ
(-Inf,0.75] (0.75,1.25] (1.25, Inf]
¥Ç¡¼¥¿ÆÃÀ­¤Î³ÎÇ§¥°¥é¥Õ
ÈæÎ¨¡ÊÊ¬»¶¡¿Ê¿¶Ñ¡Ë
%
0 20 40 60 80
(-Inf,0.75] (0.03%)
(0.75,1.25] (89.09%)
(1.25, Inf] (10.88%)
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 58 / 103

Part2 社内データベースの利用 ポアソン分布の特徴理解
CW5 内データの平均・分散・その比
±0.25 の変動を認めた場合，薬剤× PT の組み合わせの約 91%は Poisson 分布を基にした
推定が可能と推察される．
Poisson 分布のパラメータ推定から発生傾向の把握
評価対象期間での報告期待値の把握
上記の把握した値を使って，客観的なリスク評価ができる．直接検定の枠組みで確率を求
め評価できる．残りの約 9%については複雑な事例に該当し，複雑なモデルを用いる必要
性があるかもしれない．
逆をいえば「約 90%はポアソン分布で予測可能」と分かるので，このパラメータを用いれ
ば良い．
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 59 / 103

Part2 社内データベースの利用 ポアソン分布で説明困難な事象例
自発報告の収集事情（世の中単純じゃない）
医薬品の副作用報告は単純な調査とは異なる背景を持っている．
病気や副作用が起こらなかったら病院に行かない
０例情報が切断される．ゼロ切断ポアソンモデル（zero-truncated）
重篤な AE は報告されやすく，軽微な AE は報告されにくい
０例情報が増加する．ゼロ過剰ポアソンモデル（zero-inﬂated）
０例情報が減少する．ゼロ過少ポアソンモデル（zero-deﬂated）
これらの事情に対応するモデルを総称して，ゼロ修正ポアソンモデルという 10．
WHO,FDA が用いる複数パラメータ，潜在パラメータを含むモデルが必要かもしれない．
過分散・疎分散に対応するモデル
Gamma Poisson 分布（ベイズの枠組み）
幾何分布，負の二項分布
混合分布モデル
潜在クラスモデル（Latent Parameter Model ）
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 60 / 103

Part2 社内データベースの利用 ポアソン分布で説明困難な事象例
複雑なデータ事例 1-1：PRS の悪心
PRS-°­¿´(mean:2.51)
Êó¹ð¿ô/MONTH
COUNT
0 5 10 15
0 10 20 30 40
ÍýÏÀÌ©ÅÙ(É¸ËÜÊ¿¶Ñ)
·Ð¸³Ì©ÅÙ
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 61 / 103

Part2 社内データベースの利用 ポアソン分布で説明困難な事象例
複雑なデータ事例 1-2：PRS の悪心
Poisson Goodfit test (PRS-°­¿´ mean:2.51)
-2
-1
0
1
2
3
4
0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16
Number of Occurrences
sqrt(Frequency)
●
●
●
●
●
●
●
●
● ● ● ● ● ● ● ● ●
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 62 / 103

Part2 社内データベースの利用 ポアソン分布で説明困難な事象例
複雑なデータ事例 2-1：CYM の不眠症
CYM-ÉÔÌ²¾É(mean:3.11)
Êó¹ð¿ô/MONTH
COUNT
0 2 4 6 8 10 12 14
0 10 20 30 40
ÍýÏÀÌ©ÅÙ(É¸ËÜÊ¿¶Ñ)
·Ð¸³Ì©ÅÙ
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 63 / 103

Part2 社内データベースの利用 ポアソン分布で説明困難な事象例
複雑なデータ事例 2-2：CYM の不眠症
Poisson Goodfit test (CYM-ÉÔÌ²¾É mean:3.11)
-2
-1
0
1
2
3
4
0 1 2 3 4 5 6 7 8 9 10 11 12 13 14
Number of Occurrences
sqrt(Frequency)
●
●
● ●
●
●
●
●
●
● ● ● ● ● ●
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 64 / 103

Part2 社内データベースの利用 ポアソン分布で説明困難な事象例
複雑なデータ事例 3-1：PRS の光線過敏性反応
PRS-¸÷Àþ²áÉÒÀ­È¿±þ(mean:4.17)
Êó¹ð¿ô/MONTH
COUNT
0 5 10 15
0 5 10 15 20 25 30 35 ÍýÏÀÌ©ÅÙ(É¸ËÜÊ¿¶Ñ)
·Ð¸³Ì©ÅÙ
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 65 / 103

Part2 社内データベースの利用 ポアソン分布で説明困難な事象例
複雑なデータ事例 3-2：PRS の光線過敏性反応
Poisson Goodfit test (PRS-¸÷Àþ²áÉÒÀ­È¿±þ mean:4.17)
-2
-1
0
1
2
3
0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16
Number of Occurrences
sqrt(Frequency)
●
●
●
● ●
●
●
●
●
●
●
● ● ● ● ● ●
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 66 / 103

Part2 社内データベースの利用 複雑な事象に対応するモデル
複雑な事象に対応するモデルの概略・雑 I
過分散を示した約 9%を見ると，P. 64 の CYM，P. 66 の PRS 例が示すようにポアソン
分布から，ずれが確認されるモノや多峰性を示すモノがあるようだ．モデルを変える必要
があるかもしれない．
ポアソン分布からのずれが確認されるモノ
ゼロ修正モデルについては，すでに薬業では岩崎と中外，エーザイのそれぞれが共同研究
している．それら先行研究によれば，ゼロ修正モデルは医薬品有害事象やマーケティング
領域で有効だろうことを述べている．詳しくは専門書にゆずり，このモデルは海外で数理
的に zero-Inﬂated（ゼロ過剰）モデルや zero-Hurdle（ゼロハードル）モデルとも呼ば
れる．
多峰性を示すモノ
通常用いられる確率分布は、一様分布を除けば、全て、一つの峰を持った分布である．と
ころが、実務においては，二つ以上の峰を持った分布を考えねばならない場合がある．こ
のようなとき，一番単純なモデルは一つの峰を持った分布を必要な数だけそろえ，そのそ
れぞれにウェイトをかけて，たし合わせたものである． 「必要な数」が測定不能なので潜
在パラメータとなる．こういった「測定できない」モノの仮定は現代社会ではおかしなこ
とではなく，そもそも調査が実現できないマーケティング分野や社会心理学で古くから利
用されている．
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 67 / 103

Part2 社内データベースの利用 複雑な事象に対応するモデル
複雑な事象に対応するモデルの概略・雑 II
ゼロ修正モデルは， 「０」の度数に潜在クラスを仮定している．WHO の BCPNN，FDA
の MGPS が採用しているシグナル検出値は潜在クラスを仮定した混合分布である．
クラス数は２つとは限らないが FDA も WHO も最も基本的な 2 クラスを仮定し，パラ
メータ a,b（a>b）の小さい側の b を用いて算出した期待値でリスク評価している．
近年，EM アルゴリズム（Dempster, A.P., Laird, N.M., Rubin, D.B., 1977 ）という数理
理論の発達により，潜在モデルの推定が容易になってきている．後に事例を紹介するこの
反復法は時間を要するが初期値問題から逃れられるなど性質の良い点を評価して，今回の
推定で用いている．
従来の数値最適化ライブラリで潜在モデルを推定すると，ニュートン法を主としたモノの
ため，収束は高速だが，初期値により推定結果に差異がでる．初期値の設定が難しく山口
のような素人では使いにくかった．
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 68 / 103

Part2 社内データベースの利用 ゼロ修正ポアソン分布
修正モデル（ゼロ切断ポアソン分布） I
一般化切断ポアソン分布は
P(x|x ≥ k) = Pr(X = x|X ≥ k) = 1
Pr(X ≥ k) × λx
x! e−λ
=
λx
x! e−λ
∑∞
y=k
λy
y! e−λ
「調査」は有害事象が発生せねば医師にかからないことから，ゼロ切断となる．k = 1 すな
わち X ≥ 1 がゼロ切断されたポアソン分布となるので，
p(x|x ≥ 1) = λxe−λ /x!
1−e−λ (18)
= λxe−λ
x!(1−e−λ ) = λx
x!(eλ −1) (19)
(18) は 確率の公理から導出され， ∑∞
y=1
λy
y! e−λ = 1 −e−λ から，(19) となる．
これをゼロ切断ポアソン分布 (ZTP:Zero-truncated Poisson Distribution) と呼ぶ．ZTP の
期待値，分散の導出は専門書（[2][岩崎 P.157]）によると，
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 69 / 103

Part2 社内データベースの利用 ゼロ修正ポアソン分布
修正モデル（ゼロ切断ポアソン分布） II
E[X|X ≥ 1] = λ
1−e−λ (20)
V[X|X ≥ 1] = λ
1−e−λ − λ2e−λ
(1−e−λ )2 (21)
(20) と (21) から ZTP では分散 < 期待値であり分散／期待値は１以下になる 11．
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 70 / 103

Part2 社内データベースの利用 ゼロ修正ポアソン分布
ZTP 確認用 CW5 内データの分散／平均比
(-Inf,0.75] (0.75,1] (1,1.25] (1.25, Inf]
¥Ç¡¼¥¿ÆÃÀ­¤Î³ÎÇ§¥°¥é¥Õ
ÈæÎ¨¡ÊÊ¬»¶¡¿Ê¿¶Ñ¡Ë
%
0 20 40 60 80
(-Inf,0.75] (0.03%)
(0.75,1] (85.52%)
(1,1.25] (3.57%)
(1.25, Inf] (10.88%)
分散／期待値 ≤ 1・・・おどろくべき結果である．ゼロ切断を示すようだ．山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 71 / 103

Part2 社内データベースの利用 ゼロ修正ポアソン分布
ZTP を物語る証拠？
もし 0.75 から 1.25 の区間を真ん中の 1 で区切った時，誤差の類であるならば 1 以上，1
以下は 50:50 になるはず．しかし約 96 対 4 となっている 12．
打ち切りおよびトランケーションの下でのパラメータ推定に及ぼす切断点の影響
評価，
岩崎 学 (成蹊大学理工学部情報科学科),
阿部 貴行 (万有製薬株式会社臨床医薬研究所生物統計部統計解析課)[5]
ゼロ修正されたポアソン分布におけるゼロ修正パラメータの統計的推測，大道寺 香
澄（エーザイ株式会社コーポレートメディカルアフェアーズ本部安全管理部） ，岩崎
学 [6]
先達の慧眼に恐れ入るところである．岩崎氏は肩書が医薬品医療機器総合機構 専門委員
や日本計量生物学会の理事さまなど豪華絢爛なエライ先生である．同じ学さんでもエライ
違いである．
ありがたく研究成果をちょうだいさせて頂き，自分のビジネスに応用することとする．
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 72 / 103

Part2 社内データベースの利用 パラメータ推定プログラム
ZTP のパラメータ推定（EM 事始め） I
理論がわかってもパラメータを求められなければ，ビジネスにならない．
尤度の微分が陽に解けない今回の場合，工学的知識を使って数値計算で求めるとになる．
N ＋ M 個のデータ x と y が未知パラメータ θ ベクトルを持つとき，確率密度 p(x,y|θ)
函数の θ ベクトルを推定する問題は尤度法推定と呼ばれる．
この時，y が観測できなかったとする．この欠損データを含むデータを不完全データと
呼ぶ．
不完全データに対しては尤度推定ができないので，不明な y について積分すると
p(x|θ) =
∫
p(x,y|θ)dy．が得られる．計算がらくな対数尤度
log p(x|θ) = log
∫
y p(x,y|θ)dy (22)
を最大にする θ を推定する．
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 73 / 103

Part2 社内データベースの利用 パラメータ推定プログラム
ZTP のパラメータ推定（EM 事始め） II
周辺化，積分消去
多変量の確率密度関数のある変数について，
取りうる範囲に渡り積分したモノは残りの変数に関する確率密度を表す．この確率分布
は周辺分布といい，この操作 (22) を周辺化と呼ぶ．
p(x|θ) =
∫
···
∫
p(x,y|θ)dy1 ··· dyM
=
∫
y p(x,y|θ)dy
不完全データからの最尤推定は，欠測データに関して周辺化を行って観測データのみの周
辺分布を作り，それに対する最尤推定を行うことになる．すなわち周辺分布密度関数に観
測データを代入した尤度を最大にする（[13][金谷 P.153]） ．
(22) は直接計算が困難だが，それを EM Algorithm で解くことができる．
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 74 / 103

Part2 社内データベースの利用 パラメータ推定プログラム
ZTP のパラメータ推定（EM 事始め） III
Procedure EM(p(x,y|θ))
1 未知パラメータ θ の初期値 θ(0) を与え，K = 0 とする
2 E-step として関数を計算する
QK(θ) =Ey|x,θ(K) [log p(x,y|θ)] (23)
3 M-step として QK(θ) を最大にする θ を θ(K+1) とする
4 K = K + 1 として E-step に戻り，収束するまで反復
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 75 / 103

Part2 社内データベースの利用 パラメータ推定プログラム
ZTP のパラメータ推定（EM 事始め） IV
E-step(23) の関数
QK(θ) =Ey|x,θ(K) [log p(x,y|θ)]
は「パラメータが θ の時にデータ x,y を同時に観察する同時確率密度は，仮定により
p(x,y|θ) と表せる．
この時，データ x が観測された時（とすれば） ，欠測データy が取り得る値 の可能性を
与える y の事後確率密度はベイズの定理より，
p(y|x,θ) = p(x,y|θ)∫
p(x,y|θ)dy (24)
パラメータが θ であり x が得られた時の条件付き確率は (24)．
(23) の対数尤度の期待値は， 「(24) の θ に反復過程で直前に計算した θK を代入した
p(y|x,θK)」に関する期待値となる．
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 76 / 103

Part2 社内データベースの利用 パラメータ推定プログラム
ZTP のパラメータ推定（EM 事始め） V
Proof.
(22) の対数尤度を θ で微分すると
∇θ log p(x|θ) = ∇θ
∫
p(x,y|θ)dy∫
p(x,y|θ)dy =
∫ ∇θ p(x,y|θ)∫
p(x,´y|θ)d ´y d ´y
=
∫ ∇θ p(x,y|θ)
p(x,y|θ)
p(x,y|θ)∫
p(x,´y|θ)d ´y dy
=
∫
∇θ log p(x,y|θ)p(y|x,θ)dy
(25) は (24) から導かれ，その中の p(y|x,θ) の θ を θK と書き直す．
∫
∇θ log p(x,y|θ)p(y|x,θ(K))dy = ∇θ
∫
log p(x,y|θ)p(y|x,θ(K))dy
= ∇θ Ey|x,θ(K) [log p(x,y|θ)] =∇θ QK(θ) (25)
(25) を０にすることは， (23) の函数 QK(θ) の極値を計算する意味になる．
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 77 / 103

Part2 社内データベースの利用 パラメータ推定プログラム
ZTP のパラメータ推定
EM Algorithm を正しく理解したとして？ ZTP のパラメータを算出する．
観測されない Pr(X = 0|λ) の時の度数を f0 と置く． 観測されたデータの度数をm と置く．
完全データは n = f0 + m．P. 50 の Poisson 分布より f0 = ne−λ ．
DB のクエリで window 集計された x ≥ 1 のデータの和は ω = x1 + ··· + xm と表記できる．
l(λ) = log
f0+m
∏
i=0
λx
xi
e−λ (26)
= (logλ)ω −
f0+m
∑
x=0
log(xi!) −( f0 + m)λ (27)
E[ ˆf0] = ( f0 + m)eλ (28)
E[ˆλ] = ω
f0+m (29)
完全データが得られたときの条件付き確率 (E-step) は (28) の ˆf 0
0 を適当な初期値 0 で推
定し， 得られた値を (29) にて λ1 を推定する．λ1 から再度反復して f 1
0 と更新する．こ
れを収束するまで繰り返す．
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 78 / 103

Part2 社内データベースの利用 パラメータ推定プログラム
スティーブンス・ジョンソン症候群 ZTP 推定事例
FMXA のスティーブンス・ジョンソン症候群 (S.J.) について推定する．
CodePT は FMXA の S.J. が合計「16 例」事例報告されたことを示す（CodePT の total
sum） ．
DENSITY は S.J. が月単位で合計 「16 回」 報告されたことを示す （YEARMON の count） ．
YEARMON CODE PT CNT ICSRS MONTH CodePT Dtot DENSITY
1 2009 05 FMXA スティーブンス・ジョンソン症候群 1 11 16 811 16
2 2009 06 FMXA スティーブンス・ジョンソン症候群 1 18 16 811 16
3 2009 12 FMXA スティーブンス・ジョンソン症候群 1 9 16 811 16
4 2010 04 FMXA スティーブンス・ジョンソン症候群 1 26 16 811 16
5 2011 07 FMXA スティーブンス・ジョンソン症候群 1 9 16 811 16
6 2011 09 FMXA スティーブンス・ジョンソン症候群 1 8 16 811 16
7 2012 02 FMXA スティーブンス・ジョンソン症候群 1 16 16 811 16
8 2012 10 FMXA スティーブンス・ジョンソン症候群 1 15 16 811 16
9 2012 12 FMXA スティーブンス・ジョンソン症候群 1 9 16 811 16
10 2013 10 FMXA スティーブンス・ジョンソン症候群 1 8 16 811 16
11 2014 02 FMXA スティーブンス・ジョンソン症候群 1 10 16 811 16
12 2014 03 FMXA スティーブンス・ジョンソン症候群 1 15 16 811 16
13 2014 11 FMXA スティーブンス・ジョンソン症候群 1 6 16 811 16
14 2014 12 FMXA スティーブンス・ジョンソン症候群 1 10 16 811 16
15 2015 01 FMXA スティーブンス・ジョンソン症候群 1 18 16 811 16
16 2015 02 FMXA スティーブンス・ジョンソン症候群 1 5 16 811 16
統計的知識があれば，パラメータ推定はこの２種類の情報だけで推定できることがわかる．
この性質を「十分統計量」といい，これを利用すると SQL DB の負荷を減らし素早く計算できる
（統計 ⇒ 支援 ⇒ エンジニアリング ⇒ 実現） ．
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 79 / 103

Part2 社内データベースの利用 パラメータ推定プログラム
ZTP パラメータ推定プログラム例
EMZIP <- function(ALPHA=CodePT,DENS_PERDB=DENSITY){
w <- unique(ALPHA) # w: >0 の data sum
m <- unique(DENS_PERDB)# m:不完全データの観測回数
f0 <- 0 # f0: ０切断の数
lambda0 <- w/m # 初期値
lambda1 <- w/m
eps <- 10e-6 # 終了条件（７ケタ以上だと終わらない）
cnt <- 0 # 非収束対策カウンター
while(1){
f1 <- (m+f0)*exp(-lambda0) # E-step
lambda1 <- w/(m + f1) # M-step
if(abs(lambda0 -lambda1) < eps || abs(f1 -f0) < eps) break
# 収束判定はLogLiklyhood判定でもOK．
f0 <- f1
lambda0 <- lambda1
if(cnt > 10000) break #Divergence予防．1000だと収束条件に不足
cnt <- cnt+1
}
# printf(" iteration was %.0f\n",cnt)# Debug Print Orz
{return(lambda1)}
}
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 80 / 103

Part2 社内データベースの利用 パラメータ推定プログラム
自然な推定値と EM 推定推移
この DB は 75 か月間のデータであり，自然な平均は 16
75 ≈ 0.21 である．同自然な分散は
0.17 であり，分散／平均の比はおよそ 0.79 と１以下になる．
先のプログラムを用いて推定すると反復の後，設定精度に達して収束し0.0272 と ZTP の
λ 推定値を得る．この事例は分散が極めて小さい（情報量が少ない）ため，収束条件が極
めて難しい．このため，１０００回以上の反復が必要だった．
> EMZTPitrCounter(16, 16)
iteration(0) eps 0.26894142 欠測値 5.8861
iteration(1) eps 0.12810263 欠測値 10.5359
iteration(2) eps 0.07871377 欠測値 14.5202
...
...
iteration(1369) eps 0.00001001 欠測値 571.5895
iteration(1370) eps 0.00001000 欠測値 571.8054
iteration(1371) eps 0.00000999 欠測値 572.0212
iteration was 1371
$lambda
[1] 0.0272
$f0
[1] 572
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 81 / 103

Part2 社内データベースの利用 パラメータ推定プログラム
Poisson 分布の使い方 3
パラメータによる他剤比較
ZTP のパラメータを同一有害事象×薬剤間で比較すればその有害事象の
見かけの因果関係 を比較できるもしれない
PT CODE CodePT DENSITY ZTPlambda NORlambda variance ratioV E
1 スティーブンス・ジョンソン症候群 PT 4 2 1.59 0.05 0.13 2.45
2 スティーブンス・ジョンソン症候群 VCMP 3 2 0.87 0.04 0.07 1.63
3 スティーブンス・ジョンソン症候群 BKT-TAB 11 8 0.67 0.15 0.23 1.58
4 スティーブンス・ジョンソン症候群 PLGA 25 20 0.46 0.33 0.38 1.15
5 スティーブンス・ジョンソン症候群 VCMJ 5 4 0.46 0.07 0.09 1.33
6 スティーブンス・ジョンソン症候群 CYM 3 3 0.03 0.04 0.04 0.96
7 スティーブンス・ジョンソン症候群 FMN 3 3 0.03 0.04 0.04 0.96
8 スティーブンス・ジョンソン症候群 FMXA 16 16 0.03 0.21 0.17 0.79
9 スティーブンス・ジョンソン症候群 VEG 4 4 0.03 0.05 0.05 0.95
10 スティーブンス・ジョンソン症候群 FMXC 2 2 0.03 0.03 0.03 0.97
11 スティーブンス・ジョンソン症候群 BKT-GRA 1 1 0.03 0.01 0.01 0.99
12 スティーブンス・ジョンソン症候群 EXJ 1 1 0.03 0.01 0.01 0.99
13 スティーブンス・ジョンソン症候群 FBX 1 1 0.03 0.01 0.01 0.99
14 スティーブンス・ジョンソン症候群 KRC 1 1 0.03 0.01 0.01 0.99
15 スティーブンス・ジョンソン症候群 MDS 1 1 0.03 0.01 0.01 0.99
16 スティーブンス・ジョンソン症候群 MDT 1 1 0.03 0.01 0.01 0.99
17 スティーブンス・ジョンソン症候群 NS 1 1 0.03 0.01 0.01 0.99
18 スティーブンス・ジョンソン症候群 PLG-INT 1 1 0.03 0.01 0.01 0.99
19 スティーブンス・ジョンソン症候群 RAC 1 1 0.03 0.01 0.01 0.99
20 スティーブンス・ジョンソン症候群 RDJ 1 1 0.03 0.01 0.01 0.99
21 スティーブンス・ジョンソン症候群 SGS 1 1 0.03 0.01 0.01 0.99
Table: S.J. について ZTP 母数による薬剤間剤比較
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 82 / 103

Part2 社内データベースの利用 ゼロ過剰ポアソンモデルパラメータ推定
ゼロ修正モデルからのゼロ過剰ポアソンモデル
ゼロ修正されたポアソンモデルは Pr(y|λ,ω) 次のように定義される．
Pr(y|λ,ω) =
{
ω + (1 −ω)eλ (x = 0)
(1 −ω)λx e−λ
x! (x ≧ 1)
ω は定数であり 0 ≤ Pr(X = 0) ≤ 1 と制限される．詳しくは専門書に譲り，この修正ポア
ソンモデルは結論的にゼロ過剰ポアソンモデルに帰着し，０のみを確率１とする一点分布
I0(x) と ω : (1 −ω) の混合分布である ωIo(x) + (1 −ω)Poisson(λ) となる．
これをゼロ過剰ポアソン分布（ZIP:Zero-Infrated Poisson Distribution ）と呼ぶ．
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 83 / 103

Part2 社内データベースの利用 ゼロ過剰ポアソンモデルパラメータ推定
ゼロ過剰ポアソンモデルの尤度関数
ZIP の尤度関数 L(λ,ω) は f0 を０度数とし，独立ｎ個の観測 x1,x2,··· ,xn とした時の尤
度関数は，
L(λ,ω) ={ω + (1 −ω)e−λ }f0
∏
y≥1
{(1 −ω)λyi e−λ ⧸yi!}
となって陽に解けない．
そこで未知の観測度数を M とすると，完全データの尤度関数は，
L(λ,ω) = ωn−M ∏M
i=1 (1 −ω)λxi e−λ ⧸xi!
= ωn−M(1 −ω)Me−Mλ λ∑M
i=1 xi ⧸∏M
i=1 xi (30)
なので (30) の尤度関数を解く．
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 84 / 103

Part2 社内データベースの利用 ゼロ過剰ポアソンモデルパラメータ推定
ZIP の E ステップ
(30) の対数尤度は，観測された値の和を A =
M
∑
i=1
xi = ∑
x≥1
xi と書き直せば，
l(λ,ω) = ( n −M)logω + M log(1 −ω) −Mλ + Alogλ −log∏M
i=1 xi! (31)
(31) を偏微分して ∂l(λ,ω)
∂λ = ∂l(λ,ω)
∂ω = 0 より尤度方程式を得る．
∂l(λ,ω)
∂λ = −M + A
λ = 0
∂l(λ,ω)
∂ω = n−M
ω − M
1−ω = 0
M-step は，完全データの λ と ω の最尤推定値を求めるから，
ˆλ = A
M , ˆω = 1 − M
n
となる．
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 85 / 103

Part2 社内データベースの利用 ゼロ過剰ポアソンモデルパラメータ推定
EM Algorithmによる反復パラメータ推定 I
E-step は下記になる．
ˆλ = A
M (M −step)
ˆω = 1 − M
n (M −step)
λ が与えられたとき，y = 1 以上の観察カウントを m とすると，ゼロカウントにおける
Poisson 分布部分の期待値は Me−λ であるので， M = m + Me−λ より M-step は下記と
なる．
ˆM = m
1−e−λ (E −step)
m は DB から SQL window 関数で count 関数をラップして算出し，E-step の定数として
用いる．
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 86 / 103

Part2 社内データベースの利用 ゼロ過剰ポアソンモデルパラメータ推定
EM Algorithmによる反復パラメータ推定 II
実際の推定においては，初期値 ˆM0 として m を用いる（[2][岩崎，P165]） ．得られたM1
を代入し（E-step） ，λ1，ω1 を求める（M-step）
得られた λ1 を再度 E-step に代入し，逐次反復法により計算する．収束条件は対数尤度，
情報量基準（AIC，BIC など）が設定され，その差 ≤ ε により終了判定させる．
ZTP のパラメータは P.80 のプログラムで得られる ZTP 推定値 ˆλ を用い， ˆM = m
1−eˆλ か
ら ˆM をもとめ，最後に ˆω = 1 − ˆM
n を求めることが証明されているので，再利用すれば
データ処理時間を短縮できる．
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 87 / 103

Part2 社内データベースの利用 ゼロ過剰ポアソンモデルパラメータ推定
ZIP のパラメータ推定
擬似コード
ZIPestimate <-function(lambda, n= SumOfAE, m= CountOfAE){
M = m/(1-exp(-lambda))
w = 1 - M/n
hoge hoge
fuga fuga
（混合率の t-検定により，過剰パラメータωの妥当性を見る）
（省略）
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 88 / 103

Part2 社内データベースの利用 ゼロ過剰ポアソンモデルパラメータ推定
渡辺による EM Algorithmの利点
EM Algorithm は，不完全データから最尤推定値を導くための統一的なframework であ
り，反復回数が多いことなどの問題点が指摘されていたが，framework の単純性と収束の
安定性，適用モデルの汎用性などの利点が勝り，今日に至るまでに，工学・医学・社会
学・経営学など統計モデルが必要とされるほぼすべての分野で用いられる．
渡辺 [12, p.228] によると，
もし， f (y|θ) が，多項分布，ポアソン分布，正規分布などの指数分布族の範疇
に入るモデルであれば，E-step と M-step は θ の十分統計量 t = t(x) を媒介に
したステップに置き換えることができ，更に分かり易くなる．
ポアソン分布の十分統計量は合計だから，都合の良いことに社内DB から SQL 集計関数
や Window 関数を用いれば 5 ケタの DB なら 1 分をも必要としない．RDBM が Oracle な
ので両者が使えるのも好都合である．また，
EM アルゴリズムでは，とくに完全データが指数分布族の範疇であれば，各ス
テップにおける出力が統計的に意味のあるものになっている．すなわち，自然
にパラメータの定義域や制約条件が充たされ，かつ容易に制約条件を組み込ん
で解を得ることができる．いわゆる不適解が出ない．
Poisson 分布は指数分布族なので，不適解が出ないのも好都合であり今回のプログラム
は，パラメータベクトルの前後差が 10−6 以下である時に収束と判定しているが，理論的
に問題がない．またこの反復法は初期値の影響を受けにくい仕組みになっており，反復に
より推定値の精度が上がる 13．
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 89 / 103

Part2 社内データベースの利用 ゼロ過剰ポアソンモデルパラメータ推定
不備：PRS 光線過敏症の混合分布ぐあい
0 10 20 30 40 50 60
5 10 15
PRS¸÷Àþ²áÉÒÀ­È¿±þ
Index
count
●
●
●
●●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●
●●
●
●
●●
●●
●
●
●
●
●
●
●
●
●
●●
●
●●
●
●
●
●
●●
●
●
●
●
●
●
●
●
●
●●
●
●
●
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 90 / 103

Part2 社内データベースの利用 ゼロ過剰ポアソンモデルパラメータ推定
不備：CYM-傾眠の混合分布ぐあい
0 10 20 30 40 50 60
0 5 10 15 20 25 30
CYM-·¹Ì²
Index
count
●●
●
●●●
●●
●●
●●●●
●●●
●
●
●●●●●●●
●●
●
●●
●●●
●●●●
●
●
●●●
●
●●
●
●
●
●
●
●●●
●●
●
●●●
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 91 / 103

Part2 社内データベースの利用 第二部のまとめ
第二部のまとめ I
シグナル検出について EMA Guidline には次の記載がある．
期待されること
データマイニング手法が適切に運用されるとき，ともすれば検出されなかった，あるいは
実際にはより遅く検出されたであろういくつかのシグナルを検出することができ，ファー
マコビジランスプログラムの効率を高めるかもしれない。
留意事項
シグナル検出プログラムへ統計学的データマイニング手法を組み入れるためには，①選択
されたデータ源や②統計学的手法の強みや限界に対する完全な理解，及び③データマイニ
ング手法の適用についての十分な技術的専門知識が必要である。
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 92 / 103

Part2 社内データベースの利用 第二部のまとめ
第二部のまとめ II
①については，社内で集めたデータ，保存方法について十分な理解が必要なことを示しこ
れには大多数の社員が関与した結晶であり「完全である」と仮定して良かろう．
③については，プログラミング，SQL スキルが含まれるが，非専門家が多いことから解説
省略．山口は RDBM やプログラミング経験が 10 年以上，統計的プログラミング経験が 5
年以上ある．これが不十分なら計算がそもそもできない．ほぼ「まちがいなし」とみなし
て良かろう．
②についての「限界・強み」を示すには，きちんと数式から導出し根拠を示す必要があ
る．数理モデルは医薬領域での先行研究や心理・経済・生態学の領域などで，アカデミア
ですでに理論的に体系化され保証されているので，理解して活用すればよいから，問題な
かろう．
ここで塩野義として②の「限界」について知っておく必要がある．統計的手法の強みを生
かすために集めたデータの限界を考える．
P. 34 で示すように 91%もの組み合わせは 6/75 回しか観察されていない．ベイズをのぞ
けば，最尤推定原理による推定において「６サンプルサイズ」は絶望的な数字である．
推定精度を示す指標をフィッシャー情報量と呼び，この量が大きくなると精度は上がる．
この精度情報は簡単なモデルでは大きく，複雑なモデルでは小さくなるので，情報量の観
点からはたとえ仕組みが妥当でもポアソン分布を用いることが相対的によい結果を示す可
能性が高い． 「６」では，複雑なモデルを精度よく推定できないため．
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 93 / 103

Part2 社内データベースの利用 第二部のまとめ
第二部のまとめ III
さまざまなモデルを数理的に示したのは，複雑な事象を説明するモデルには複数のパラ
メータが必要となり，ある程度大きな情報量が期待されることを示すため．
数式は「理論値」なので無限に情報量があるときには必ず点で推定されるが，
わが社のもつ推定精度的情報量は少ないため， 「限界」があることを知ることが必要で
ある．
経験上 30 以上の試行があれば複雑なモデルが利用できるが，わが社にははおよそ
6000 ∗0.5しかない．
①，②の「強み」 ，③はすべて「学習」し「訓練」により習得できるので内的因子といえる
が，②の「限界」は会社でどうすることもできない外的因子といえるである．これに制限
されるため，その理論的限界を超えた精度情報を得ることはできない．
一方で，この低い精度・少ないデータで意思決定を行わなければならないのが安全性の領
域と思われる．この状況で情報（データ）を補正・補助するために，専門知識や（事前）
情報を組み合わせていることが透明ならベイズ定理を利用できる 14．ベイズ定理の利用
については第三部で一部触れる．
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 94 / 103

Part2 社内データベースの利用 第二部のまとめ
第二部のまとめ IV
シグナル検出について理解を深めつつ，実データに則り事例を示した
社内安全性 DB の CW5 内データ約 22 万例，薬剤と PT ベースの有害事象組み合わせ約
6000 組について新提案ルール（ポアソン分布のパラメータを行った．
先行研究に則り，ゼロ修正モデルである ZTP パラメータを具体的にデータに対し算出し，
約 80%が説明できるだろうことを示した
シグナル検出理解と限界についての序論紹介した
複雑な事例についての対応は第三部で説明する
各モデルについて，情報量からの限界を示す
複雑な事例である約 20%については，負の二項分布（のベイズ推定）などの複数パラメー
タモデルや混合分布を使って推定する
「こちら」リンクに分析結果を保存する．初期・初動対応として約 80%のモノはいわゆる
「個別症例評価」から「集積された情報の評価」に対応する基礎情報として十分活用でき
るだろう．
約 80%はすぐさま実戦配置してよい！ と宣言し，第二部のまとめとする．
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 95 / 103

複雑な事象に対応するモデル適用
Part3 複雑なパターンを示す社内データの分析
複雑な事例に対する情報分析について
FDA・WHO や心理学・計量経済領域のモデル活用
安全管理部＠検討会効率化 WT5
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 96 / 103

複雑な事象に対応するモデル適用
過分散，欠測対応
過分散に対応できる
複数パラメータを持つ分布
ベイズアプローチ
混合モデル（latent パラメータを EM で）
FDA のまねっこ
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 97 / 103

複雑な事象に対応するモデル適用 Gamma Poison = Negative Binomial
不備
この他ネットワーク関係の分析に GLM へと応用
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 98 / 103

複雑な事象に対応するモデル適用 Bayes approch
不備
2014 年，もっとも初めに作ったベイズ理論の公式変形により確率を求める
Pr(X = x) =P(X|θ) ×P(θ) ÷P(θ|X)
の関係から報告一件あたりの PT 発生件数を，ガンマ関数を用いて計算．平均，分散を別
パラメータに持つことから，潜在変数モデル以外に幅広く対応できるモデルの活用．
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 99 / 103

複雑な事象に対応するモデル適用 EM による混合モデルへの対応
混合分布
EM アルゴリズムにより潜在変数を求め，１潜在変数下での2 クラス間で最小パラメータ
による期待値を推定する．薬業 FDA では (M)GPS と呼ばれる
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 100 / 103

性能評価（シミュレーション） ダミーデータ生成による性能比較
ダミーデータによる性能シミュレーション
real データの頻度 ABC 分析による現実に近いデータの発生
ある期間で一定して２，４，８，１０倍
A(超低頻度）
B(中頻度）
C(高頻度）
ある期間の途中で２，４，８，１０倍！！！ とか
企業としては，こっちが欲しいよね．
WT で PRR のみで良い論＜＝打ち砕く
年次とかではいいっけさ．
たぶん，5 年の蓄積データで今月，4 半期とかのレベルで A，B は確認できる可能性は理論
的に低い （Fisher 情報量 （ちかい信頼区間） が） がエントロピーが大きいゆえの不確実性．
不確実性を逃れるには 4 倍，8 倍などの上昇が必要．モデルより，結局 3 例ルールが勝つ
かも（爆笑）
PRR,ROR は否定的に終わるだろう． ．行政と企業のニーズの違い．先行研究によりベイ
ズアプローチはよい．だが・・・・
期間内 5 年で平均３が翌年，翌月５とかに変化したものは検出できない．やっぱりモデル
がいいよね．的な
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 101 / 103

まとめ
まとめ
早いところいわゆる「集積」に移行しよう！！
リソースを考えて
他の金になる木を探して
部員の高齢化対策？
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 102 / 103

参考文献
参考文献
[1] 岩崎学，阿部貴行（万有製薬）, 正確法と近似法によるカウントデータの解析法
[2] 岩崎学, カウントデータの統計解析 (統計ライブラリー)
[3] 岩崎学, 廉 民善 , ゼロトランケーションのあるカウントデータの解析,
[4] 岩崎学, 稀な事象の生起確率に関する統計的推測
[5] 岩崎 学 , 阿部 貴行 (万有)，打ち切りおよびトランケーションの下でのパラメータ推定
に及ぼす切断点の影響評価
[6] 大道寺 香澄（エーザイ安全管理部） , ゼロ修正されたポアソン分布におけるゼロ修正
パラメータの統計的推測
[7] 松原望, ベイズ統計学概説―フィッシャーからベイズへ
[8] 松下泰之, 製薬企業の自発報告データベースに基づく安全性情報検出法の研究
[8] 奥村 晴彦，三重大学， ポアッソン分布
[9] 小宮山　靖, 医薬品評価委員会　データサイエンス部会, 続編，くすりと有害事象の因
果関係
[10] 大島康雄, 日本内科学会雑誌, Vol. 100 (2011) No. 8 p. 2323-2333, Evidence-based
Medicine（EBM）有害事象と医薬品の因果関係評価について
[11] 一般化ポアソン分布及びポリアーエゲンベルガー分布の構造化パラメータを用いた
誤答数のモデル, 行動計量学 19 巻 2 号 (通 巻 37 号)
[12] 渡辺美智子，第 III 部 統計計算の展開と統計科学
[13] 金谷 健一， これなら分かる最適化数学―基礎原理から計算手法，共立出版
山口 学 (安全管理部) 三例五例ルールの数理的基礎と推定への応用 2015-04-21(Thu) 103 / 103