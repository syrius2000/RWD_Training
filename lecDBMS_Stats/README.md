# `lecDBMS_Stats` ディレクトリのスクリプト解説

このディレクトリには、RDBMS（MySQL）に格納されたRWD（リアルワールドデータ）を統計的に分析するためのスクリプトが含まれています。

## ファイル一覧と概要

### Rスクリプト

- `VACCINE_YB.R`
  - **目的**: `VACCINE` データベース内の各テーブルから重複するレコードを検出し、CSVファイルとして出力します。
  - **処理内容**:
    1. `RMySQL` を使用して `VACCINE` データベースに接続します。
    2. `ClinicalExam`, `DrugDS`, `DrugIV`, `Inpatient`, `Outpatient`, `Rezept`, `Vital` などの主要テーブルに対して、全カラムの内容が完全に一致するレコードを `GROUP BY` と `COUNT` を用いて特定します。
    3. 重複しているレコード（`COUNT > 1`）を抽出し、`DUP/` ディレクトリ配下にテーブルごとのCSVファイル（例: `Dup.ClinicalExam.CSV`）として保存します。
    4. 最後に、各テーブルで検出された重複レコード数をコンソールに出力します。
  - **用途**: データの品質評価（Data Quality Assessment）の一環として、データクレンジング前に重複データの存在量を確認するために使用します。

- `UniqCountRun.R`
  - **目的**: 指定されたテーブルの各カラムにおけるユニークな値の数と、その値を持つレコード数を集計します。
  - **処理内容**:
    1. `UniqCount.SQL` をテンプレートとして読み込みます。
    2. スクリプト内で指定されたテーブル名とカラム名（`__TARGET_TABLE__`, `__TARGET_COLUMN__`）を置換し、動的にSQLクエリを生成します。
    3. 生成したSQLを実行し、結果を `UniqCount.csv` として保存します。
  - **用途**: データプロファイリング。各カラムのデータのばらつきや分布を把握するために使用します。

- `makeICD_Code.R`
  - **目的**: ICD-10コードの集計や整形を行うためのスクリプトです。
  - **処理内容**: （詳細な処理はスクリプト内に記述）
  - **用途**: 傷病名データ（ICD-10）の標準化や集計分析に使用します。

- `init.R`
  - **目的**: Rセッションの初期設定を行います。
  - **処理内容**: `options()` 関数を用いて、表示幅などの環境設定を行います。

### SQLスクリプト

- `ListAllColumn.sql`
  - **目的**: データベース内のすべてのテーブルと、それぞれのカラム情報を一覧表示するためのSQLクエリです。
  - **処理内容**: `information_schema` を参照して、テーブル名とカラム名、データ型などを取得します。
  - **用途**: データベースの構造を俯瞰的に把握するために使用します。

- `UniqCount.SQL`
  - **目的**: `UniqCountRun.R` から利用されるSQLテンプレートです。
  - **処理内容**: プレースホルダ `__TARGET_TABLE__` と `__TARGET_COLUMN__` を含んでおり、特定のテーブルの特定のカラムについて、値ごとの出現回数をカウントします。

### その他

- `DUP/`
  - `VACCINE_YB.R` によって出力された重複レコードのCSVファイルが格納されるディレクトリです。

- `*.csv`
  - スクリプトの実行結果や、分析に使用するマスタデータなどが含まれます。
    - `Code処方薬剤WELFARE.csv`
    - `Code注射薬剤WELFARE1.csv`
    - `Code病名データ.csv`
    - `Code病名データ_カルテオーダ.csv`
    - `UniqCount.csv`

## 実行方法

各Rスクリプトは、R環境で `source()` 関数を使って実行できます。

**例: `VACCINE_YB.R` の実行**
```R
source("VACCINE_YB.R")
```

**注意**:
- スクリプトを実行する前に、`VACCINE` データベースへの接続情報（ホスト、ユーザー名、パスワード）が `VACCINE_YB.R` 内の `FetchData` 関数で正しく設定されていることを確認してください。
- `RMySQL` などの必要なパッケージがインストールされている必要があります。
